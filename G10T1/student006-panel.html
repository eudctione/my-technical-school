<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل دانش‌آموز مکانیک خودرو - ai-daneshmand.ir</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jalaali-js@1.1.0/dist/jalaali-js.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;200;300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Vazirmatn', sans-serif;
        }

        :root {
            /* پالت رنگی آبی فیروزه‌ای */
            --primary: #19d3da;
            --primary-light: #3ae1e8;
            --primary-dark: #12bfc7;
            --primary-darker: #0aaab3;
            --primary-darkest: #067e8b;
            
            --secondary: #045f6d;
            --accent: #ff6b6b;
            --accent-light: #ff8e8e;
            
            --metal-dark: #1a1a1a;
            --metal-light: #2d2d2d;
            --metal-bright: #4a4a4a;
            
            --danger: #ff4757;
            --warning: #ffa502;
            --info: #2ed573;
            --success: #1e90ff;
            
            --gray-50: #f8f9fa;
            --gray-100: #f1f2f6;
            --gray-200: #dfe4ea;
            --gray-300: #ced6e0;
            --gray-400: #a4b0be;
            --gray-500: #747d8c;
            --gray-600: #57606f;
            --gray-700: #2f3542;
            --gray-800: #1e272e;
            --gray-900: #171923;
            
            /* گرادیان‌های جدید */
            --gradient-1: linear-gradient(135deg, #19d3da 0%, #12bfc7 100%);
            --gradient-2: linear-gradient(135deg, #3ae1e8 0%, #19d3da 100%);
            --gradient-3: linear-gradient(135deg, #0aaab3 0%, #067e8b 100%);
            --gradient-4: linear-gradient(135deg, #045f6d 0%, #033a43 100%);
        }

        .rtl {
            direction: rtl;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-darker) 100%);
            min-height: 100vh;
        }

        /* جلوه شیشه‌ای مدرن */
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* جلوه متالیک */
        .metal-effect {
            background: linear-gradient(145deg, var(--metal-dark), var(--metal-light));
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            color: white;
        }

        /* متن مشکی متالیک */
        .metallic-text {
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        .gradient-bg {
            background: var(--gradient-1);
        }

        .floating-card {
            box-shadow: 0 8px 30px rgba(25, 211, 218, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .floating-card:hover {
            box-shadow: 0 12px 40px rgba(25, 211, 218, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .hover-lift {
            transition: all 0.3s ease;
        }

        .hover-lift:hover {
            transform: translateY(-3px);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: rgba(173, 181, 189, 0.5) transparent;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgba(173, 181, 189, 0.5);
            border-radius: 3px;
        }

        .tooltip {
            position: relative;
        }

        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #343a40;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 50;
            border: 1px solid #dee2e6;
        }

        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 5px);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Persian Calendar Styles */
        .persian-date-picker {
            position: relative;
        }

        .persian-date-input {
            cursor: pointer;
            background-color: white;
        }

        .persian-calendar-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .persian-calendar-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            overflow: hidden;
        }

        .persian-calendar-header {
            background: var(--gradient-1);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .persian-calendar-body {
            padding: 1rem;
        }

        .persian-calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .persian-calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .persian-calendar-day-header {
            font-weight: 600;
            color: var(--gray-600);
            padding: 0.5rem;
        }

        .persian-calendar-day {
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .persian-calendar-day:hover {
            background-color: var(--gray-100);
        }

        .persian-calendar-day.selected {
            background-color: var(--primary);
            color: white;
        }

        .persian-calendar-day.today {
            background-color: var(--primary-light);
            color: white;
        }

        .persian-calendar-day.other-month {
            color: var(--gray-400);
        }

        .persian-calendar-footer {
            border-top: 1px solid var(--gray-200);
            padding-top: 1rem;
            text-align: center;
        }
        
        /* New Date Input Styles */
        .date-input-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-input-field {
            width: 80px;
            text-align: center;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .date-input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(25, 211, 218, 0.1);
        }
        
        .date-input-separator {
            color: var(--gray-500);
            font-weight: 500;
        }
        
        .weekday-display {
            margin-top: 8px;
            padding: 8px 12px;
            background-color: var(--gray-50);
            border-radius: 8px;
            font-size: 14px;
            color: var(--gray-700);
            text-align: center;
            transition: all 0.2s;
        }
        
        .weekday-display.valid {
            background-color: rgba(30, 144, 255, 0.1);
            color: var(--success);
        }
        
        .date-input-error {
            margin-top: 4px;
            font-size: 12px;
            color: var(--danger);
        }

        /* Test Results Styles */
        .test-results {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 1rem;
        }

        .test-results-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .test-pass {
            color: var(--success);
        }

        .test-fail {
            color: var(--danger);
        }

        .test-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 6px;
            background: var(--gray-50);
        }

        .test-item.pass {
            border-right: 4px solid var(--success);
        }

        .test-item.fail {
            border-right: 4px solid var(--danger);
        }

        /* Whale Logo Inspired Styles */
        .whale-gradient {
            background: var(--gradient-1);
        }

        .whale-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(25, 211, 218, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .whale-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(25, 211, 218, 0.25);
        }

        .metal-badge {
            background: linear-gradient(145deg, var(--metal-dark), var(--metal-light));
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .nav-item {
            transition: all 0.3s ease;
            border-radius: 10px;
        }

        .nav-item:hover {
            background: rgba(25, 211, 218, 0.1);
            transform: translateX(-5px);
        }

        .nav-item.active {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 12px rgba(25, 211, 218, 0.3);
        }

        .accent-border {
            border-left: 4px solid var(--accent);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(25, 211, 218, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(25, 211, 218, 0.15);
        }

        .btn-primary {
            background: var(--gradient-1);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(25, 211, 218, 0.3);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(25, 211, 218, 0.4);
            background: var(--gradient-2);
        }

        .btn-secondary {
            background: var(--gradient-3);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(10, 170, 179, 0.3);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(10, 170, 179, 0.4);
        }

        .btn-accent {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
        }

        .btn-accent:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 107, 107, 0.4);
        }

        /* Header Styles */
        .main-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 20px rgba(25, 211, 218, 0.1);
        }

        /* Sidebar Styles */
        .main-sidebar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-left: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 4px 0 20px rgba(25, 211, 218, 0.1);
        }

        /* Content Area */
        .main-content {
            background: rgba(248, 250, 252, 0.8);
        }

        /* Notification Styles */
        .notification-success {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px rgba(25, 211, 218, 0.3);
        }

        .notification-error {
            background: linear-gradient(135deg, var(--danger) 0%, #ff2e4e 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

        .notification-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #ff9500 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 165, 2, 0.3);
        }

        .notification-info {
            background: linear-gradient(135deg, var(--info) 0%, #26c95a 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 213, 115, 0.3);
        }

        /* Class Schedule Styles */
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .schedule-table th, .schedule-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: center;
        }
        
        .schedule-table th {
            background-color: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        
        .schedule-table td {
            background-color: white;
            transition: all 0.2s;
        }
        
        .schedule-table td:hover {
            background-color: #f0fff4;
        }
        
        .time-slot {
            font-weight: 600;
            color: #2d3748;
        }
        
        .class-cell {
            cursor: pointer;
            border-radius: 4px;
        }
        
        .class-cell:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Jalaali Calendar Styles */
        .jalaali-calendar {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .jalaali-header {
            background: var(--gradient-1);
            color: white;
            padding: 1rem;
            text-align: center;
        }
        
        .jalaali-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1rem;
            background-color: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .jalaali-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: #edf2f7;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .jalaali-weekday {
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            color: #4a5568;
        }
        
        .jalaali-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e2e8f0;
        }
        
        .jalaali-day {
            background-color: white;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .jalaali-day:hover {
            background-color: #f7fafc;
        }
        
        .jalaali-day.today {
            background-color: #ebf8ff;
            color: var(--primary);
            font-weight: 600;
        }
        
        .jalaali-day.selected {
            background-color: var(--primary);
            color: white;
        }
        
        .jalaali-day.other-month {
            color: #a0aec0;
            background-color: #f7fafc;
        }
        
        .jalaali-events {
            font-size: 0.7rem;
            margin-top: 4px;
        }
        
        .jalaali-event {
            background-color: var(--success);
            color: white;
            border-radius: 4px;
            padding: 1px 4px;
            margin-top: 2px;
        }

        /* Educational Content Styles */
        .content-tree {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .content-node {
            border-bottom: 1px solid #e2e8f0;
        }
        
        .content-node:last-child {
            border-bottom: none;
        }
        
        .content-header {
            padding: 1rem;
            background-color: #f7fafc;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .content-header:hover {
            background-color: #edf2f7;
        }
        
        .content-header.active {
            background-color: #ebf8ff;
            border-right: 4px solid var(--primary);
        }
        
        .content-children {
            padding-right: 2rem;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .content-children.expanded {
            max-height: 1000px;
        }
        
        .content-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .content-item:last-child {
            border-bottom: none;
        }
        
        .content-item:hover {
            background-color: #f7fafc;
        }
        
        .content-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 1rem;
        }
        
        .content-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Course Detail Styles */
        .course-detail-panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .detail-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .detail-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-left: 1rem;
        }

        .detail-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--metal-dark);
        }

        .detail-subtitle {
            color: var(--gray-600);
            margin-top: 0.5rem;
        }

        .detail-content {
            margin-bottom: 2rem;
            line-height: 1.8;
            color: var(--gray-700);
        }

        .detail-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .detail-section {
            background: var(--gray-50);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .section-title-sm {
            font-weight: 600;
            color: var(--metal-dark);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .section-content ul {
            list-style: none;
            padding: 0;
        }

        .section-content li {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: white;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .section-content li:hover {
            transform: translateX(-5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .learning-link {
            display: block;
            color: var(--metal-dark);
            text-decoration: none;
            transition: all 0.2s;
        }

        .learning-link:hover {
            color: var(--primary);
        }

        .link-description {
            display: block;
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-top: 0.25rem;
        }

        .detail-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            padding-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }

        .detail-btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--primary);
            border-radius: 8px;
            background: white;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-btn:hover {
            background: var(--gray-50);
        }

        .detail-btn.primary {
            background: var(--gradient-1);
            color: white;
        }

        .detail-btn.primary:hover {
            background: var(--gradient-2);
        }
    </style>
</head>
<body class="rtl">
    <div id="root"></div>

    <script type="text/babel">
        // =============================================
        // پیکربندی اصلی سیستم
        // =============================================
        const BACKEND = {
            enabled: false,
            baseUrl: 'https://api.example.com'
        };

        // =============================================
        // توابع کمکی برای ارتباط با بک‌اند
        // =============================================
        const apiFetch = async (path, options = {}) => {
            if (!BACKEND.enabled) {
                throw new Error('Backend is disabled');
            }

            try {
                const response = await fetch(`${BACKEND.baseUrl}${path}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.warn('API fetch failed, falling back to localStorage:', error);
                throw error;
            }
        };

        // =============================================
        // ابزارهای تاریخ فارسی - کاملاً اصلاح شده
        // =============================================
        const PersianDateUtils = {
            toPersianDate: (date) => {
                if (!date) return '';
                
                try {
                    // اگر تاریخ رشته فارسی است، برگردان
                    if (typeof date === 'string' && date.includes('/')) {
                        return date;
                    }
                    
                    const gDate = new Date(date);
                    if (isNaN(gDate.getTime())) return '';
                    
                    const jalaaliDate = jalaali.toJalaali(gDate);
                    return `${jalaaliDate.jy}/${jalaaliDate.jm.toString().padStart(2, '0')}/${jalaaliDate.jd.toString().padStart(2, '0')}`;
                } catch (e) {
                    console.error('Error converting to Persian date:', e);
                    return '';
                }
            },
            
            toGregorianDate: (persianDate) => {
                if (!persianDate) return '';
                
                try {
                    const parts = persianDate.split('/');
                    if (parts.length !== 3) return '';
                    
                    const jy = parseInt(parts[0]);
                    const jm = parseInt(parts[1]);
                    const jd = parseInt(parts[2]);
                    
                    if (isNaN(jy) || isNaN(jm) || isNaN(jd)) return '';
                    
                    const gregorianDate = jalaali.toGregorian(jy, jm, jd);
                    const date = new Date(gregorianDate.gy, gregorianDate.gm - 1, gregorianDate.gd);
                    return date.toISOString().split('T')[0];
                } catch (e) {
                    console.error('Error converting to Gregorian date:', e);
                    return '';
                }
            },
            
            getCurrentPersianDate: () => {
                const today = new Date();
                return PersianDateUtils.toPersianDate(today);
            },
            
            isValidPersianDate: (year, month, day) => {
                if (!year || !month || !day) return false;
                
                try {
                    const y = parseInt(year);
                    const m = parseInt(month);
                    const d = parseInt(day);
                    
                    if (isNaN(y) || isNaN(m) || isNaN(d)) return false;
                    if (y < 1300 || y > 1500) return false;
                    if (m < 1 || m > 12) return false;
                    
                    // بررسی روزهای هر ماه
                    const monthDays = [31, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 29];
                    
                    // بررسی سال کبیسه
                    const isLeapYear = jalaali.isLeapJalaaliYear(y);
                    if (isLeapYear) monthDays[11] = 30;
                    
                    if (d < 1 || d > monthDays[m-1]) return false;
                    
                    return true;
                } catch (e) {
                    return false;
                }
            },
            
            getPersianWeekday: (year, month, day) => {
                if (!PersianDateUtils.isValidPersianDate(year, month, day)) return '';
                
                try {
                    const gregorianDate = PersianDateUtils.toGregorianDate(`${year}/${month}/${day}`);
                    if (!gregorianDate) return '';
                    
                    const date = new Date(gregorianDate);
                    const weekday = date.getDay();
                    
                    const weekdays = ['یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه', 'جمعه', 'شنبه'];
                    return weekdays[weekday];
                } catch (e) {
                    return '';
                }
            },
            
            getJalaaliMonthName: (month) => {
                const monthNames = [
                    'فروردین', 'اردیبهشت', 'خرداد', 'تیر', 'مرداد', 'شهریور',
                    'مهر', 'آبان', 'آذر', 'دی', 'بهمن', 'اسفند'
                ];
                return monthNames[month - 1] || '';
            },
            
            // تابع جدید برای تولید تقویم یک ماه
            getJalaaliMonthCalendar: (year, month) => {
                try {
                    const daysInMonth = jalaali.jalaaliMonthLength(year, month);
                    const firstDay = jalaali.toGregorian(year, month, 1);
                    const firstDate = new Date(firstDay.gy, firstDay.gm - 1, firstDay.gd);
                    const firstWeekday = (firstDate.getDay() + 1) % 7; // تبدیل به شنبه=0
                    
                    const calendar = [];
                    
                    // روزهای ماه قبل
                    const prevMonth = month === 1 ? 12 : month - 1;
                    const prevYear = month === 1 ? year - 1 : year;
                    const daysInPrevMonth = jalaali.jalaaliMonthLength(prevYear, prevMonth);
                    
                    for (let i = 0; i < firstWeekday; i++) {
                        const day = daysInPrevMonth - firstWeekday + i + 1;
                        calendar.push({
                            day,
                            isCurrentMonth: false,
                            date: { jy: prevYear, jm: prevMonth, jd: day }
                        });
                    }
                    
                    // روزهای ماه جاری
                    for (let i = 1; i <= daysInMonth; i++) {
                        calendar.push({
                            day: i,
                            isCurrentMonth: true,
                            date: { jy: year, jm: month, jd: i }
                        });
                    }
                    
                    // روزهای ماه بعد
                    const nextMonth = month === 12 ? 1 : month + 1;
                    const nextYear = month === 12 ? year + 1 : year;
                    const remainingDays = 42 - calendar.length; // 6 rows * 7 days
                    
                    for (let i = 1; i <= remainingDays; i++) {
                        calendar.push({
                            day: i,
                            isCurrentMonth: false,
                            date: { jy: nextYear, jm: nextMonth, jd: i }
                        });
                    }
                    
                    return calendar;
                } catch (e) {
                    console.error('Error generating calendar:', e);
                    return [];
                }
            }
        };

        // =============================================
        // سیستم مدیریت State اصلی
        // =============================================
        const createStudentStore = () => {
            let listeners = new Set();
            
            // داده‌های خالی اولیه
            let initialState = {
                currentStudent: {
                    id: '',
                    name: '',
                    studentId: '',
                    email: '',
                    classId: '',
                    phone: ''
                },
                classes: [],
                assignments: [],
                submissions: [],
                courseContents: [],
                sessions: [],
                grades: [],
                notifications: [],
                classSchedule: [],
                calendarEvents: [],
                educationalContent: [],
                
                // وضعیت UI
                sidebarOpen: false,
                activeTab: 'dashboard',
                notification: null,
                searchTerm: '',
                selectedClass: 'all'
            };

            // بازیابی از localStorage
            const savedState = localStorage.getItem('student-store');
            if (savedState) {
                try {
                    const parsed = JSON.parse(savedState);
                    initialState = { ...initialState, ...parsed };
                } catch (e) {
                    console.warn('خطا در بازیابی state:', e);
                }
            }

            let state = initialState;

            const setState = (newState) => {
                state = { ...state, ...newState };
                localStorage.setItem('student-store', JSON.stringify(state));
                listeners.forEach(listener => listener());
            };

            const subscribe = (listener) => {
                listeners.add(listener);
                return () => listeners.delete(listener);
            };

            const getState = () => state;

            const actions = {
                setActiveTab: (tab) => setState({ activeTab: tab, sidebarOpen: false }),
                toggleSidebar: () => setState({ sidebarOpen: !state.sidebarOpen }),
                
                showNotification: (message, type = 'info') => {
                    const notification = { message, type, id: Date.now() };
                    setState({ notification });
                    setTimeout(() => {
                        if (getState().notification?.id === notification.id) {
                            setState({ notification: null });
                        }
                    }, 5000);
                },
                hideNotification: () => setState({ notification: null }),
                
                setSearchTerm: (term) => setState({ searchTerm: term }),
                setSelectedClass: (classId) => setState({ selectedClass: classId }),
                
                // =============================================
                // DEVELOPER: این بخش برای مدیریت تکالیف است
                // می‌توانید قابلیت‌های جدیدی اینجا اضافه کنید
                // =============================================
                addAssignment: (assignment) => {
                    const newAssignment = {
                        id: Date.now().toString(),
                        ...assignment,
                        createdAt: new Date().toISOString()
                    };
                    const assignments = [...state.assignments, newAssignment];
                    setState({ assignments });
                    actions.showNotification('تکلیف جدید اضافه شد', 'success');
                },
                
                updateAssignment: (id, updates) => {
                    const assignments = state.assignments.map(assignment =>
                        assignment.id === id ? { ...assignment, ...updates } : assignment
                    );
                    setState({ assignments });
                    actions.showNotification('تکلیف به‌روزرسانی شد', 'success');
                },
                
                deleteAssignment: (id) => {
                    const assignments = state.assignments.filter(assignment => assignment.id !== id);
                    setState({ assignments });
                    actions.showNotification('تکلیف حذف شد', 'success');
                },
                
                // مدیریت ارسال تکالیف
                addSubmission: (submission) => {
                    const newSubmission = {
                        id: Date.now().toString(),
                        ...submission,
                        submittedAt: new Date().toISOString()
                    };
                    const submissions = [...state.submissions, newSubmission];
                    setState({ submissions });
                    actions.showNotification('پاسخ شما با موفقیت ارسال شد', 'success');
                    return newSubmission;
                },
                
                updateSubmission: (id, updates) => {
                    const submissions = state.submissions.map(submission =>
                        submission.id === id 
                            ? { ...submission, ...updates }
                            : submission
                    );
                    setState({ submissions });
                    actions.showNotification('پاسخ به‌روزرسانی شد', 'success');
                },
                
                // =============================================
                // DEVELOPER: این بخش برای مدیریت برنامه کلاسی است
                // می‌توانید قابلیت‌های جدیدی اینجا اضافه کنید
                // =============================================
                updateClassSchedule: (schedule) => {
                    setState({ classSchedule: schedule });
                    actions.showNotification('برنامه کلاسی به‌روزرسانی شد', 'success');
                },
                
                // =============================================
                // DEVELOPER: این بخش برای مدیریت رویدادهای تقویم است
                // می‌توانید قابلیت‌های جدیدی اینجا اضافه کنید
                // =============================================
                addCalendarEvent: (event) => {
                    const newEvent = {
                        id: Date.now().toString(),
                        ...event
                    };
                    const calendarEvents = [...state.calendarEvents, newEvent];
                    setState({ calendarEvents });
                    actions.showNotification('رویداد جدید به تقویم اضافه شد', 'success');
                },
                
                updateCalendarEvent: (id, updates) => {
                    const calendarEvents = state.calendarEvents.map(event =>
                        event.id === id ? { ...event, ...updates } : event
                    );
                    setState({ calendarEvents });
                    actions.showNotification('رویداد به‌روزرسانی شد', 'success');
                },
                
                deleteCalendarEvent: (id) => {
                    const calendarEvents = state.calendarEvents.filter(event => event.id !== id);
                    setState({ calendarEvents });
                    actions.showNotification('رویداد حذف شد', 'success');
                },
                
                // =============================================
                // DEVELOPER: این بخش برای مدیریت محتوای آموزشی است
                // می‌توانید قابلیت‌های جدیدی اینجا اضافه کنید
                // =============================================
                updateEducationalContent: (content) => {
                    setState({ educationalContent: content });
                    actions.showNotification('سرفصل‌های آموزشی به‌روزرسانی شد', 'success');
                },
                
                addEducationalItem: (parentId, item) => {
                    const newItem = {
                        id: Date.now().toString(),
                        ...item
                    };
                    
                    const updateContent = (contents) => {
                        return contents.map(content => {
                            if (content.id === parentId) {
                                return {
                                    ...content,
                                    children: [...(content.children || []), newItem]
                                };
                            }
                            if (content.children) {
                                return {
                                    ...content,
                                    children: updateContent(content.children)
                                };
                            }
                            return content;
                        });
                    };
                    
                    const educationalContent = updateContent(state.educationalContent);
                    setState({ educationalContent });
                    actions.showNotification('محتوا اضافه شد', 'success');
                },
                
                // علامت‌گذاری اعلان به عنوان خوانده شده
                markNotificationAsRead: (id) => {
                    const notifications = state.notifications.map(notif =>
                        notif.id === id ? { ...notif, read: true } : notif
                    );
                    setState({ notifications });
                },
                
                markAllNotificationsAsRead: () => {
                    const notifications = state.notifications.map(notif => 
                        ({ ...notif, read: true })
                    );
                    setState({ notifications });
                    actions.showNotification('همه اعلان‌ها خوانده شدند', 'success');
                },
                
                // به‌روزرسانی پروفایل
                updateProfile: (updates) => {
                    const currentStudent = { ...state.currentStudent, ...updates };
                    setState({ currentStudent });
                    actions.showNotification('پروفایل با موفقیت به‌روزرسانی شد', 'success');
                },
                
                // پشتیبان‌گیری
                exportData: () => {
                    const data = {
                        currentStudent: state.currentStudent,
                        submissions: state.submissions,
                        calendarEvents: state.calendarEvents,
                        classSchedule: state.classSchedule,
                        educationalContent: state.educationalContent,
                        exportedAt: new Date().toISOString()
                    };
                    return JSON.stringify(data, null, 2);
                }
            };

            return {
                getState,
                setState,
                subscribe,
                ...actions
            };
        };

        const studentStore = createStudentStore();

        const useStudentStore = () => {
            const [state, setState] = React.useState(studentStore.getState());

            React.useEffect(() => {
                return studentStore.subscribe(() => setState(studentStore.getState()));
            }, []);

            return { ...state, ...studentStore };
        };

        // =============================================
        // DEVELOPER: کامپوننت‌های پایه
        // می‌توانید کامپوننت‌های جدید اینجا اضافه کنید
        // =============================================
        const Button = ({ 
            children, 
            onClick, 
            type = 'button', 
            variant = 'primary', 
            size = 'md', 
            disabled = false,
            loading = false,
            className = '',
            icon,
            tooltip,
            ...props 
        }) => {
            const baseClasses = 'rounded-lg font-medium transition-all duration-200 flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-offset-2';
            
            const variantClasses = {
                primary: 'btn-primary',
                secondary: 'btn-secondary',
                accent: 'btn-accent',
                outline: 'bg-transparent border border-blue-600 text-blue-600 hover:bg-blue-50'
            };
            
            const sizeClasses = {
                sm: 'px-3 py-1.5 text-sm',
                md: 'px-4 py-2 text-sm',
                lg: 'px-6 py-3 text-base'
            };
            
            const disabledClasses = disabled || loading ? 'opacity-50 cursor-not-allowed' : 'hover-lift';
            
            return (
                <button
                    type={type}
                    onClick={onClick}
                    disabled={disabled || loading}
                    className={`${baseClasses} ${variantClasses[variant]} ${sizeClasses[size]} ${disabledClasses} ${className} ${tooltip ? 'tooltip' : ''}`}
                    data-tooltip={tooltip}
                    aria-label={tooltip}
                    {...props}
                >
                    {loading && (
                        <i className="fas fa-spinner fa-spin ml-2"></i>
                    )}
                    {icon && !loading && <i className={`fas ${icon} ${children ? 'ml-2' : ''}`}></i>}
                    {children}
                </button>
            );
        };

        const Card = ({ children, className = '', hoverable = true, ...props }) => {
            return (
                <div 
                    className={`whale-card rounded-xl p-6 ${hoverable ? 'hover:shadow-lg' : ''} ${className}`}
                    {...props}
                >
                    {children}
                </div>
            );
        };

        const FormInput = ({ 
            label, 
            type = 'text', 
            value, 
            onChange, 
            placeholder, 
            required = false,
            error,
            className = '',
            ...props 
        }) => {
            return (
                <div className={className}>
                    {label && (
                        <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                            {label}
                            {required && <span className="text-red-500 mr-1">*</span>}
                        </label>
                    )}
                    <input 
                        type={type}
                        value={value}
                        onChange={onChange}
                        placeholder={placeholder}
                        className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 ${
                            error ? 'border-red-500' : 'border-gray-300'
                        }`}
                        {...props}
                    />
                    {error && <p className="mt-1 text-sm text-red-600">{error}</p>}
                </div>
            );
        };

        // =============================================
        // DEVELOPER: کامپوننت فیلد تاریخ فارسی
        // می‌توانید ویژگی‌های جدیدی اینجا اضافه کنید
        // =============================================
        const PersianDateInput = ({ value, onChange, placeholder = "انتخاب تاریخ", required = false, label }) => {
            const [year, setYear] = React.useState('');
            const [month, setMonth] = React.useState('');
            const [day, setDay] = React.useState('');
            const [weekday, setWeekday] = React.useState('');
            const [error, setError] = React.useState('');

            React.useEffect(() => {
                if (value) {
                    const parts = value.split('/');
                    if (parts.length === 3) {
                        setYear(parts[0]);
                        setMonth(parts[1]);
                        setDay(parts[2]);
                        calculateWeekday(parts[0], parts[1], parts[2]);
                    }
                }
            }, [value]);

            const calculateWeekday = (y, m, d) => {
                if (PersianDateUtils.isValidPersianDate(y, m, d)) {
                    const weekdayName = PersianDateUtils.getPersianWeekday(y, m, d);
                    setWeekday(weekdayName);
                    setError('');
                } else {
                    setWeekday('');
                    setError('تاریخ نامعتبر است');
                }
            };

            const handleYearChange = (e) => {
                const newYear = e.target.value;
                setYear(newYear);
                if (newYear && month && day) {
                    calculateWeekday(newYear, month, day);
                    onChange(`${newYear}/${month}/${day}`);
                }
            };

            const handleMonthChange = (e) => {
                const newMonth = e.target.value;
                setMonth(newMonth);
                if (year && newMonth && day) {
                    calculateWeekday(year, newMonth, day);
                    onChange(`${year}/${newMonth}/${day}`);
                }
            };

            const handleDayChange = (e) => {
                const newDay = e.target.value;
                setDay(newDay);
                if (year && month && newDay) {
                    calculateWeekday(year, month, newDay);
                    onChange(`${year}/${month}/${newDay}`);
                }
            };

            const handleBlur = () => {
                if (year && month && day) {
                    if (!PersianDateUtils.isValidPersianDate(year, month, day)) {
                        setError('تاریخ نامعتبر است');
                    }
                } else if (required && (!year || !month || !day)) {
                    setError('تاریخ الزامی است');
                }
            };

            return (
                <div className="mb-4">
                    {label && (
                        <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                            {label}
                            {required && <span className="text-red-500 mr-1">*</span>}
                        </label>
                    )}
                    <div className="date-input-container">
                        <input
                            type="text"
                            value={year}
                            onChange={handleYearChange}
                            onBlur={handleBlur}
                            placeholder="1400"
                            maxLength="4"
                            className="date-input-field"
                        />
                        <span className="date-input-separator">/</span>
                        <input
                            type="text"
                            value={month}
                            onChange={handleMonthChange}
                            onBlur={handleBlur}
                            placeholder="01"
                            maxLength="2"
                            className="date-input-field"
                        />
                        <span className="date-input-separator">/</span>
                        <input
                            type="text"
                            value={day}
                            onChange={handleDayChange}
                            onBlur={handleBlur}
                            placeholder="01"
                            maxLength="2"
                            className="date-input-field"
                        />
                    </div>
                    {weekday && (
                        <div className={`weekday-display ${PersianDateUtils.isValidPersianDate(year, month, day) ? 'valid' : ''}`}>
                            {weekday}
                        </div>
                    )}
                    {error && <div className="date-input-error">{error}</div>}
                </div>
            );
        };

        // =============================================
        // DEVELOPER: کامپوننت تقویم جلالی - کاملاً اصلاح شده
        // =============================================
        const JalaaliCalendar = ({ onDateSelect, events = [] }) => {
            const [currentDate, setCurrentDate] = React.useState(() => {
                const now = new Date();
                return jalaali.toJalaali(now);
            });
            
            const [selectedDate, setSelectedDate] = React.useState(null);

            const todayJalaali = React.useMemo(() => {
                const now = new Date();
                return jalaali.toJalaali(now);
            }, []);

            const navigateMonth = (direction) => {
                setCurrentDate(prev => {
                    let newMonth = prev.jm + direction;
                    let newYear = prev.jy;
                    
                    if (newMonth > 12) {
                        newMonth = 1;
                        newYear++;
                    } else if (newMonth < 1) {
                        newMonth = 12;
                        newYear--;
                    }
                    
                    return { jy: newYear, jm: newMonth, jd: 1 };
                });
            };

            const goToToday = () => {
                setCurrentDate(todayJalaali);
                setSelectedDate(todayJalaali);
                if (onDateSelect) {
                    onDateSelect(todayJalaali);
                }
            };

            const handleDateSelect = (day) => {
                const selected = { ...currentDate, jd: day };
                setSelectedDate(selected);
                if (onDateSelect) {
                    onDateSelect(selected);
                }
            };

            const calendarDays = PersianDateUtils.getJalaaliMonthCalendar(currentDate.jy, currentDate.jm);
            const weekDays = ['ش', 'ی', 'د', 'س', 'چ', 'پ', 'ج'];

            const isToday = (day) => {
                return day.jy === todayJalaali.jy && 
                       day.jm === todayJalaali.jm && 
                       day.jd === todayJalaali.jd;
            };

            const isSelected = (day) => {
                return selectedDate && 
                       day.jy === selectedDate.jy && 
                       day.jm === selectedDate.jm && 
                       day.jd === selectedDate.jd;
            };

            const getEventsForDate = (date) => {
                return events.filter(event => {
                    try {
                        const eventDate = event.date;
                        let persianDate;
                        
                        if (typeof eventDate === 'string') {
                            if (eventDate.includes('/')) {
                                persianDate = eventDate;
                            } else {
                                persianDate = PersianDateUtils.toPersianDate(eventDate);
                            }
                        } else {
                            persianDate = PersianDateUtils.toPersianDate(eventDate);
                        }
                        
                        return persianDate === `${date.jy}/${date.jm.toString().padStart(2, '0')}/${date.jd.toString().padStart(2, '0')}`;
                    } catch (e) {
                        console.error('Error checking event date:', e);
                        return false;
                    }
                });
            };

            return (
                <div className="jalaali-calendar">
                    <div className="jalaali-header">
                        <h3 className="text-lg font-semibold">
                            {PersianDateUtils.getJalaaliMonthName(currentDate.jm)} {currentDate.jy}
                        </h3>
                    </div>
                    
                    <div className="jalaali-nav">
                        <Button 
                            variant="outline" 
                            size="sm"
                            icon="fa-chevron-right"
                            onClick={() => navigateMonth(-1)}
                            aria-label="ماه قبل"
                        />
                        
                        <Button 
                            variant="primary" 
                            size="sm"
                            onClick={goToToday}
                            aria-label="برو به امروز"
                        >
                            امروز
                        </Button>
                        
                        <Button 
                            variant="outline" 
                            size="sm"
                            icon="fa-chevron-left"
                            onClick={() => navigateMonth(1)}
                            aria-label="ماه بعد"
                        />
                    </div>
                    
                    <div className="jalaali-weekdays">
                        {weekDays.map(day => (
                            <div key={day} className="jalaali-weekday">
                                {day}
                            </div>
                        ))}
                    </div>
                    
                    <div className="jalaali-days">
                        {calendarDays.map((dayObj, index) => {
                            const dayEvents = getEventsForDate(dayObj.date);
                            const isDayToday = isToday(dayObj.date);
                            const isDaySelected = isSelected(dayObj.date);
                            
                            return (
                                <div
                                    key={index}
                                    className={`jalaali-day ${
                                        !dayObj.isCurrentMonth ? 'other-month' : ''
                                    } ${isDayToday ? 'today' : ''} ${
                                        isDaySelected ? 'selected' : ''
                                    }`}
                                    onClick={() => handleDateSelect(dayObj.day)}
                                >
                                    <span>{dayObj.day}</span>
                                    {dayEvents.length > 0 && (
                                        <div className="jalaali-events">
                                            {dayEvents.slice(0, 2).map((event, idx) => (
                                                <div key={idx} className="jalaali-event" title={event.title}>
                                                    •
                                                </div>
                                            ))}
                                            {dayEvents.length > 2 && (
                                                <div className="jalaali-event">+{dayEvents.length - 2}</div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const Notification = () => {
            const { notification, hideNotification } = useStudentStore();
            
            if (!notification) return null;
            
            const notificationClass = {
                success: 'notification-success',
                error: 'notification-error',
                warning: 'notification-warning',
                info: 'notification-info'
            }[notification.type] || 'notification-info';
            
            const icon = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            }[notification.type] || 'fa-info-circle';
            
            return (
                <div className="fixed top-4 left-4 right-4 z-50 max-w-md mx-auto fade-in">
                    <div className={`${notificationClass} text-white p-4 rounded-lg shadow-lg flex items-center justify-between`}>
                        <div className="flex items-center">
                            <i className={`fas ${icon} ml-2`}></i>
                            <span>{notification.message}</span>
                        </div>
                        <button 
                            onClick={hideNotification}
                            className="text-white hover:text-gray-200 transition-colors"
                            aria-label="بستن اعلان"
                        >
                            <i className="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // =============================================
        // DEVELOPER: کامپوننت‌های اصلی رابط کاربری
        // =============================================
        const Header = () => {
            const { toggleSidebar, currentStudent } = useStudentStore();
            
            return (
                <header className="main-header sticky top-0 z-40">
                    <div className="flex items-center justify-between px-4 py-3">
                        <div className="flex items-center">
                            <button 
                                onClick={toggleSidebar}
                                className="p-2 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 transition-colors tooltip"
                                data-tooltip="منو"
                                aria-label="باز کردن منو"
                            >
                                <i className="fas fa-bars text-lg"></i>
                            </button>
                            <div className="mr-3">
                                <h1 className="text-xl font-bold text-gray-800 metallic-text">پنل دانش‌آموز مکانیک خودرو</h1>
                                <p className="text-sm text-gray-500">سامانه آموزشی ai-daneshmand.ir</p>
                            </div>
                        </div>
                        
                        <div className="flex items-center space-x-3 space-x-reverse">
                            <div className="relative">
                                <button className="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 p-1 tooltip" data-tooltip="پروفایل" aria-label="مدیریت پروفایل">
                                    <img 
                                        className="h-8 w-8 rounded-full" 
                                        src={`https://ui-avatars.com/api/?name=${encodeURIComponent(currentStudent.name || 'دانش‌آموز')}&background=19d3da&color=fff`} 
                                        alt="پروفایل دانش‌آموز"
                                    />
                                    <span className="mr-2 text-gray-700 hidden md:inline">{currentStudent.name || 'دانش‌آموز'}</span>
                                    <i className="fas fa-chevron-down text-gray-400 text-xs"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        const Sidebar = () => {
            const { sidebarOpen, activeTab, setActiveTab } = useStudentStore();
            
            const menuItems = [
                { id: 'dashboard', label: 'داشبورد', icon: 'fas fa-tachometer-alt', color: 'text-blue-500' },
    { id: 'schedule', label: 'برنامه کلاسی', icon: 'fas fa-calendar-week', color: 'text-indigo-500' },
    { id: 'attendance', label: 'حضور و غیاب', icon: 'fas fa-user-check', color: 'text-green-500' }, 
               
                { id: 'educational-content', label: 'سرفصل‌های آموزشی', icon: 'fas fa-graduation-cap', color: 'text-teal-500' },
                { id: 'assignments', label: 'تکالیف', icon: 'fas fa-tasks', color: 'text-yellow-500' },
                { id: 'content', label: 'محتوای درسی', icon: 'fas fa-book', color: 'text-pink-500' },
                { id: 'sessions', label: 'جلسات', icon: 'fas fa-calendar-alt', color: 'text-purple-500' },
                { id: 'grades', label: 'نمرات', icon: 'fas fa-chart-bar', color: 'text-teal-500' },
                { id: 'notifications', label: 'اعلان‌ها', icon: 'fas fa-bell', color: 'text-orange-500' },
                { id: 'profile', label: 'پروفایل', icon: 'fas fa-user', color: 'text-green-500' }
            ];

            return (
                <>
                    {sidebarOpen && (
                        <div 
                            className="fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden"
                            onClick={() => studentStore.toggleSidebar()}
                        ></div>
                    )}
                    
                    <aside className={`
                        main-sidebar fixed inset-y-0 right-0 z-40 w-64 transform transition-transform duration-300 ease-in-out md:translate-x-0 md:static md:z-auto
                        ${sidebarOpen ? 'translate-x-0' : 'translate-x-full'}
                    `}>
                        <div className="flex flex-col h-full">
                            <div className="flex items-center justify-center h-16 px-4 border-b border-gray-200 whale-gradient text-white">
                                <div className="flex items-center">
                                    <i className="fas fa-whale text-2xl ml-2"></i>
                                    <h2 className="text-lg font-semibold">منوی دانش‌آموز</h2>
                                </div>
                            </div>
                            
                            <nav className="flex-1 px-4 py-4 space-y-2 overflow-y-auto scrollbar-thin">
                                {menuItems.map(item => (
                                    <button
                                        key={item.id}
                                        onClick={() => setActiveTab(item.id)}
                                        className={`w-full flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 nav-item ${
                                            activeTab === item.id ? 'active' : ''
                                        }`}
                                        aria-label={item.label}
                                        aria-current={activeTab === item.id ? 'page' : undefined}
                                    >
                                        <i className={`${item.icon} ${item.color} ml-3 text-lg`}></i>
                                        {item.label}
                                        {item.id === 'notifications' && (
                                            <span className="metal-badge text-xs px-2 py-1 rounded-full mr-auto">۰</span>
                                        )}
                                    </button>
                                ))}
                            </nav>
                            
                            <div className="p-4 border-t border-gray-200">
                                <div className="flex items-center">
                                    <img 
                                        className="h-10 w-10 rounded-full" 
                                        src={`https://ui-avatars.com/api/?name=${encodeURIComponent(studentStore.getState().currentStudent.name || 'دانش‌آموز')}&background=19d3da&color=fff`} 
                                        alt="پروفایل دانش‌آموز"
                                    />
                                    <div className="mr-3">
                                        <p className="text-sm font-medium text-gray-800 metallic-text">{studentStore.getState().currentStudent.name || 'دانش‌آموز'}</p>
                                        <p className="text-xs text-gray-500">شماره دانش‌آموزی: {studentStore.getState().currentStudent.studentId || 'تعریف نشده'}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>
                </>
            );
        };

        // =============================================
        // DEVELOPER: بخش داشبورد اصلی
        // می‌توانید ویجت‌های جدید اینجا اضافه کنید
        // =============================================
        const Dashboard = () => {
            const { assignments, submissions, sessions, courseContents, notifications, currentStudent, classes } = useStudentStore();
            
            // فیلتر کردن تکالیف مربوط به دانش‌آموز فعلی
            const studentAssignments = assignments.filter(assignment => {
                if (assignment.targets && assignment.targets.type === 'all') return true;
                return assignment.targets && assignment.targets.students && assignment.targets.students.includes(currentStudent.id);
            });

            const stats = React.useMemo(() => {
                const pendingAssignments = studentAssignments.filter(assignment => {
                    const submission = submissions.find(s => s.assignmentId === assignment.id);
                    return !submission;
                }).length;

                const upcomingSessions = sessions.filter(session => {
                    const sessionDate = new Date(PersianDateUtils.toGregorianDate(session.date));
                    return sessionDate >= new Date();
                }).length;

                const unreadNotifications = notifications.filter(n => !n.read).length;

                const averageGrade = submissions.length > 0 
                    ? (submissions.reduce((sum, s) => sum + (s.grade || 0), 0) / submissions.length).toFixed(1)
                    : 0;

                return {
                    pendingAssignments,
                    upcomingSessions,
                    unreadNotifications,
                    averageGrade,
                    totalContents: courseContents.length
                };
            }, [studentAssignments, submissions, sessions, notifications, courseContents]);

            const recentActivities = [
                ...submissions.slice(0, 2).map(sub => {
                    const assignment = assignments.find(a => a.id === sub.assignmentId);
                    return {
                        type: 'submission',
                        title: `ارسال پاسخ برای ${assignment?.title || 'تکلیف'}`,
                        date: sub.submittedAt,
                        icon: 'fa-paper-plane',
                        color: 'text-green-600'
                    };
                }),
                ...notifications.slice(0, 2).map(notif => ({
                    type: 'notification',
                    title: notif.title,
                    date: notif.date,
                    icon: 'fa-bell',
                    color: 'text-blue-600'
                }))
            ].sort((a, b) => new Date(b.date) - new Date(a.date));

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">داشبورد دانش‌آموز</h2>
                            <p className="text-gray-600 mt-1">خلاصه‌ای از فعالیت‌های آموزشی شما</p>
                        </div>
                        <div className="flex space-x-3 space-x-reverse mt-4 md:mt-0">
                            <Button 
                                variant="primary" 
                                icon="fa-sync-alt"
                                onClick={() => studentStore.showNotification('داده‌ها به‌روزرسانی شد', 'success')}
                                aria-label="به‌روزرسانی داده‌ها"
                            >
                                به‌روزرسانی
                            </Button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div className="stat-card">
                            <div className="flex items-center">
                                <div className="p-3 rounded-xl bg-orange-100 text-orange-600">
                                    <i className="fas fa-tasks text-xl"></i>
                                </div>
                                <div className="mr-3">
                                    <p className="text-sm font-medium text-gray-600">تکالیف در انتظار</p>
                                    <p className="text-2xl font-bold text-gray-800 metallic-text">{stats.pendingAssignments}</p>
                                </div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="flex items-center">
                                <div className="p-3 rounded-xl bg-blue-100 text-blue-600">
                                    <i className="fas fa-calendar-alt text-xl"></i>
                                </div>
                                <div className="mr-3">
                                    <p className="text-sm font-medium text-gray-600">جلسات آینده</p>
                                    <p className="text-2xl font-bold text-gray-800 metallic-text">{stats.upcomingSessions}</p>
                                </div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="flex items-center">
                                <div className="p-3 rounded-xl bg-green-100 text-green-600">
                                    <i className="fas fa-bell text-xl"></i>
                                </div>
                                <div className="mr-3">
                                    <p className="text-sm font-medium text-gray-600">اعلان‌های جدید</p>
                                    <p className="text-2xl font-bold text-gray-800 metallic-text">{stats.unreadNotifications}</p>
                                </div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="flex items-center">
                                <div className="p-3 rounded-xl bg-purple-100 text-purple-600">
                                    <i className="fas fa-chart-line text-xl"></i>
                                </div>
                                <div className="mr-3">
                                    <p className="text-sm font-medium text-gray-600">میانگین نمرات</p>
                                    <p className="text-2xl font-bold text-gray-800 metallic-text">{stats.averageGrade}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">تکالیف اخیر</h3>
                            <div className="space-y-3">
                                {studentAssignments.slice(0, 3).map(assignment => {
                                    const submission = submissions.find(s => s.assignmentId === assignment.id);
                                    const classInfo = classes.find(c => c.id === assignment.classId);
                                    const isOverdue = new Date(PersianDateUtils.toGregorianDate(assignment.dueDate)) < new Date();
                                    
                                    return (
                                        <div key={assignment.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                                    <i className="fas fa-tasks text-blue-600"></i>
                                                </div>
                                                <div className="mr-3">
                                                    <h4 className="font-medium text-gray-800">{assignment.title}</h4>
                                                    <p className="text-sm text-gray-500">
                                                        {classInfo?.name || 'کلاس'} - مهلت: {assignment.dueDate}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="flex flex-col items-end">
                                                <span className={`metal-badge px-2 py-1 text-xs rounded-full ${
                                                    submission 
                                                        ? 'bg-green-100 text-green-800'
                                                        : isOverdue 
                                                            ? 'bg-red-100 text-red-800'
                                                            : 'bg-yellow-100 text-yellow-800'
                                                }`}>
                                                    {submission ? 'ارسال شده' : isOverdue ? 'منقضی شده' : 'در انتظار'}
                                                </span>
                                                {submission && (
                                                    <span className="text-xs text-gray-500 mt-1">
                                                        نمره: {submission.grade}/{assignment.maxScore}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                                {studentAssignments.length === 0 && (
                                    <div className="text-center py-8 text-gray-500">
                                        <i className="fas fa-tasks text-3xl mb-2"></i>
                                        <p>هیچ تکلیفی برای نمایش وجود ندارد</p>
                                    </div>
                                )}
                            </div>
                        </Card>

                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">فعالیت‌های اخیر</h3>
                            <div className="space-y-3">
                                {recentActivities.slice(0, 4).map((activity, index) => (
                                    <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <div className="flex items-center">
                                            <div className={`p-2 rounded-lg ml-3 ${activity.color.replace('text', 'bg')} bg-opacity-20`}>
                                                <i className={`fas ${activity.icon} ${activity.color}`}></i>
                                            </div>
                                            <span className="text-gray-700">{activity.title}</span>
                                        </div>
                                        <span className="text-sm text-gray-500">
                                            {new Date(activity.date).toLocaleDateString('fa-IR')}
                                        </span>
                                    </div>
                                ))}
                                {recentActivities.length === 0 && (
                                    <div className="text-center py-4 text-gray-500">
                                        <p>هیچ فعالیتی ثبت نشده است</p>
                                    </div>
                                )}
                            </div>
                        </Card>
                    </div>
                </div>
            );
        };

        // =============================================
        // DEVELOPER: بخش برنامه کلاسی
        // می‌توانید قابلیت‌های جدید اینجا اضافه کنید
        // =============================================
        const ClassSchedule = () => {
            const { classSchedule, updateClassSchedule, showNotification } = useStudentStore();
            
            const daysOfWeek = ['شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه'];
            const timeSlots = [
                '۸:۰۰ - ۹:۳۰', '۹:۳۰ - ۱۱:۰۰', '۱۱:۰۰ - ۱۲:۳۰', 
                '۱۴:۰۰ - ۱۵:۳۰', '۱۵:۳۰ - ۱۷:۰۰'
            ];

            const [editingCell, setEditingCell] = React.useState(null);
            const [editValue, setEditValue] = React.useState('');

            React.useEffect(() => {
                // اگر برنامه کلاسی خالی است، یک ساختار اولیه ایجاد کن
                if (classSchedule.length === 0) {
                    const initialSchedule = timeSlots.map((time, timeIndex) => ({
                        id: `time-${timeIndex}`,
                        time,
                        days: daysOfWeek.reduce((acc, day, dayIndex) => {
                            acc[dayIndex] = '';
                            return acc;
                        }, {})
                    }));
                    updateClassSchedule(initialSchedule);
                }
            }, [classSchedule, updateClassSchedule]);

            const handleCellClick = (timeIndex, dayIndex) => {
                const currentValue = classSchedule[timeIndex]?.days[dayIndex] || '';
                setEditingCell({ timeIndex, dayIndex });
                setEditValue(currentValue);
            };

            const handleSaveCell = () => {
                if (editingCell) {
                    const { timeIndex, dayIndex } = editingCell;
                    const updatedSchedule = [...classSchedule];
                    
                    if (!updatedSchedule[timeIndex]) {
                        updatedSchedule[timeIndex] = {
                            id: `time-${timeIndex}`,
                            time: timeSlots[timeIndex],
                            days: {}
                        };
                    }
                    
                    updatedSchedule[timeIndex].days[dayIndex] = editValue;
                    updateClassSchedule(updatedSchedule);
                    setEditingCell(null);
                    setEditValue('');
                    showNotification('برنامه کلاسی به‌روزرسانی شد', 'success');
                }
            };

            const handleCancelEdit = () => {
                setEditingCell(null);
                setEditValue('');
            };

            const handleAddTimeSlot = () => {
                const newTimeSlot = {
                    id: `time-${Date.now()}`,
                    time: `زمان جدید`,
                    days: daysOfWeek.reduce((acc, _, dayIndex) => {
                        acc[dayIndex] = '';
                        return acc;
                    }, {})
                };
                updateClassSchedule([...classSchedule, newTimeSlot]);
            };

            const handleRemoveTimeSlot = (timeIndex) => {
                const updatedSchedule = classSchedule.filter((_, index) => index !== timeIndex);
                updateClassSchedule(updatedSchedule);
                showNotification('بازه زمانی حذف شد', 'success');
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">برنامه کلاسی</h2>
                            <p className="text-gray-600 mt-1">برنامه هفتگی کلاس‌های شما</p>
                        </div>
                        <Button 
                            variant="primary"
                            icon="fa-plus"
                            onClick={handleAddTimeSlot}
                            aria-label="افزودن بازه زمانی جدید"
                        >
                            افزودن بازه زمانی
                        </Button>
                    </div>

                    <Card>
                        <div className="overflow-x-auto">
                            <table className="schedule-table">
                                <thead>
                                    <tr>
                                        <th className="time-slot">زمان</th>
                                        {daysOfWeek.map(day => (
                                            <th key={day}>{day}</th>
                                        ))}
                                        <th>عملیات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {classSchedule.map((slot, timeIndex) => (
                                        <tr key={slot.id}>
                                            <td className="time-slot">
                                                <div className="flex items-center justify-between">
                                                    <span>{slot.time}</span>
                                                    <button
                                                        onClick={() => handleRemoveTimeSlot(timeIndex)}
                                                        className="text-red-500 hover:text-red-700 p-1"
                                                        aria-label="حذف بازه زمانی"
                                                    >
                                                        <i className="fas fa-times"></i>
                                                    </button>
                                                </div>
                                            </td>
                                            {daysOfWeek.map((_, dayIndex) => (
                                                <td 
                                                    key={dayIndex}
                                                    className="class-cell"
                                                    onClick={() => handleCellClick(timeIndex, dayIndex)}
                                                >
                                                    {editingCell && 
                                                     editingCell.timeIndex === timeIndex && 
                                                     editingCell.dayIndex === dayIndex ? (
                                                        <div className="flex flex-col space-y-2">
                                                            <input
                                                                type="text"
                                                                value={editValue}
                                                                onChange={(e) => setEditValue(e.target.value)}
                                                                className="w-full p-1 border rounded text-sm"
                                                                autoFocus
                                                                onKeyDown={(e) => {
                                                                    if (e.key === 'Enter') handleSaveCell();
                                                                    if (e.key === 'Escape') handleCancelEdit();
                                                                }}
                                                            />
                                                            <div className="flex space-x-2">
                                                                <button
                                                                    onClick={handleSaveCell}
                                                                    className="text-green-600 hover:text-green-800 text-xs"
                                                                >
                                                                    <i className="fas fa-check"></i>
                                                                </button>
                                                                <button
                                                                    onClick={handleCancelEdit}
                                                                    className="text-red-600 hover:text-red-800 text-xs"
                                                                >
                                                                    <i className="fas fa-times"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ) : (
                                                        <span className="text-sm">
                                                            {slot.days[dayIndex] || '---'}
                                                        </span>
                                                    )}
                                                </td>
                                            ))}
                                            <td>
                                                <button
                                                    onClick={() => {
                                                        const newSchedule = [...classSchedule];
                                                        newSchedule[timeIndex].days = daysOfWeek.reduce((acc, _, dayIndex) => {
                                                            acc[dayIndex] = '';
                                                            return acc;
                                                        }, {});
                                                        updateClassSchedule(newSchedule);
                                                        showNotification('برنامه این سطر پاک شد', 'success');
                                                    }}
                                                    className="text-red-500 hover:text-red-700 text-sm"
                                                    aria-label="پاک کردن سطر"
                                                >
                                                    <i className="fas fa-trash-alt ml-1"></i>
                                                    پاک کردن
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>

                        {classSchedule.length === 0 && (
                            <div className="text-center py-8 text-gray-500">
                                <i className="fas fa-calendar-week text-3xl mb-2"></i>
                                <h3 className="text-lg font-medium text-gray-800 mb-2">برنامه کلاسی تعریف نشده است</h3>
                                <p className="text-gray-600">
                                    برای شروع، یک بازه زمانی جدید اضافه کنید
                                </p>
                            </div>
                        )}
                    </Card>

                    <Card>
                        <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">راهنما</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                            <div className="flex items-center">
                                <i className="fas fa-mouse-pointer text-blue-500 ml-2"></i>
                                <span>برای ویرایش روی هر سلول کلیک کنید</span>
                            </div>
                            <div className="flex items-center">
                                <i className="fas fa-plus text-green-500 ml-2"></i>
                                <span>برای افزودن بازه زمانی جدید از دکمه بالا استفاده کنید</span>
                            </div>
                            <div className="flex items-center">
                                <i className="fas fa-trash-alt text-red-500 ml-2"></i>
                                <span>برای حذف یک بازه زمانی روی آیکون قرمز کلیک کنید</span>
                            </div>
                            <div className="flex items-center">
                                <i className="fas fa-save text-purple-500 ml-2"></i>
                                <span>تغییرات به طور خودکار ذخیره می‌شوند</span>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

// =============================================
// بخش حضور و غیاب - کاملاً اصلاح شده
// =============================================
const AttendanceManagement = () => {
    const { attendance, currentStudent, classes, showNotification } = useStudentStore();
    
    // فیلتر کردن حضور و غیاب دانش‌آموز فعلی
    const studentAttendance = attendance.filter(record => 
        record.studentId === currentStudent.id
    );

    React.useEffect(() => {
        // اگر داده حضور و غیاب خالی است، داده‌های نمونه ایجاد کن
        if (studentAttendance.length === 0 && currentStudent.id) {
            const sampleAttendance = [
                {
                    id: 'att-1',
                    studentId: currentStudent.id,
                    classId: 'class-1',
                    date: '1403/01/15',
                    status: 'present',
                    recordedBy: 'مدرس اصلی',
                    recordedAt: new Date().toISOString(),
                    notes: 'حضور کامل'
                },
                {
                    id: 'att-2',
                    studentId: currentStudent.id,
                    classId: 'class-1',
                    date: '1403/01/16',
                    status: 'absent',
                    recordedBy: 'مدرس اصلی',
                    recordedAt: new Date().toISOString(),
                    notes: 'غیبت موجه'
                },
                {
                    id: 'att-3',
                    studentId: currentStudent.id,
                    classId: 'class-1',
                    date: '1403/01/17',
                    status: 'present',
                    recordedBy: 'مدرس اصلی',
                    recordedAt: new Date().toISOString(),
                    notes: 'حضور کامل'
                },
                {
                    id: 'att-4',
                    studentId: currentStudent.id,
                    classId: 'class-1',
                    date: '1403/01/18',
                    status: 'late',
                    recordedBy: 'مدرس اصلی',
                    recordedAt: new Date().toISOString(),
                    notes: 'تأخیر ۱۵ دقیقه‌ای'
                },
                {
                    id: 'att-5',
                    studentId: currentStudent.id,
                    classId: 'class-1',
                    date: '1403/01/19',
                    status: 'present',
                    recordedBy: 'مدرس اصلی',
                    recordedAt: new Date().toISOString(),
                    notes: 'حضور کامل'
                }
            ];
            
            // استفاده از action موجود برای به‌روزرسانی attendance
            studentStore.setState({ 
                attendance: [...studentStore.getState().attendance, ...sampleAttendance] 
            });
            showNotification('داده‌های نمونه حضور و غیاب بارگذاری شد', 'success');
        }
    }, [studentAttendance.length, currentStudent.id, showNotification]);

    // محاسبه آمار
    const attendanceStats = React.useMemo(() => {
        const total = studentAttendance.length;
        const present = studentAttendance.filter(a => a.status === 'present').length;
        const absent = studentAttendance.filter(a => a.status === 'absent').length;
        const late = studentAttendance.filter(a => a.status === 'late').length;
        const excused = studentAttendance.filter(a => a.status === 'excused').length;
        
        const percentage = total > 0 ? Math.round((present / total) * 100) : 0;
        
        return {
            total,
            present,
            absent,
            late,
            excused,
            percentage
        };
    }, [studentAttendance]);

    const getStatusBadge = (status) => {
        const statusConfig = {
            present: { 
                class: 'bg-green-100 text-green-800 border-green-200', 
                text: 'حاضر', 
                icon: 'fa-check' 
            },
            absent: { 
                class: 'bg-red-100 text-red-800 border-red-200', 
                text: 'غایب', 
                icon: 'fa-times' 
            },
            late: { 
                class: 'bg-yellow-100 text-yellow-800 border-yellow-200', 
                text: 'تأخیر', 
                icon: 'fa-clock' 
            },
            excused: { 
                class: 'bg-blue-100 text-blue-800 border-blue-200', 
                text: 'معذور', 
                icon: 'fa-user-clock' 
            }
        };
        
        const config = statusConfig[status] || statusConfig.absent;
        
        return (
            <span className={`metal-badge px-3 py-1 rounded-full text-sm flex items-center justify-center border ${config.class}`}>
                <i className={`fas ${config.icon} ml-1`}></i>
                {config.text}
            </span>
        );
    };

    const getStatusColor = (status) => {
        const colors = {
            present: 'text-green-600',
            absent: 'text-red-600',
            late: 'text-yellow-600',
            excused: 'text-blue-600'
        };
        return colors[status] || 'text-gray-600';
    };

    // استایل‌های CSS برای بخش حضور و غیاب
    const attendanceStyles = `
        .attendance-present { background-color: #dcfce7; color: #166534; border-color: #bbf7d0; }
        .attendance-absent { background-color: #fee2e2; color: #991b1b; border-color: #fecaca; }
        .attendance-late { background-color: #fef3c7; color: #92400e; border-color: #fde68a; }
        .attendance-excused { background-color: #dbeafe; color: #1e40af; border-color: #bfdbfe; }
        
        .attendance-stats-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .attendance-stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .attendance-table th {
            background: linear-gradient(135deg, #19d3da 0%, #12bfc7 100%);
            color: white;
            padding: 1rem;
            text-align: right;
            font-weight: 600;
        }
        
        .attendance-table td {
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
            text-align: right;
        }
        
        .attendance-table tr:hover {
            background-color: #f7fafc;
        }
        
        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
        }
    `;

    return (
        <div className="space-y-6 fade-in">
            {/* اضافه کردن استایل‌های اختصاصی */}
            <style>{attendanceStyles}</style>
            
            <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                <div>
                    <h2 className="text-2xl font-bold text-gray-800 metallic-text">حضور و غیاب</h2>
                    <p className="text-gray-600 mt-1">وضعیت حضور شما در کلاس‌ها</p>
                </div>
                <Button 
                    variant="primary"
                    icon="fa-sync-alt"
                    onClick={() => showNotification('اطلاعات حضور و غیاب به‌روزرسانی شد', 'success')}
                    aria-label="به‌روزرسانی اطلاعات حضور و غیاب"
                >
                    به‌روزرسانی
                </Button>
            </div>

            {/* آمار کلی */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div className="attendance-stats-card text-center">
                    <div className="text-2xl font-bold text-green-600 mb-2">{attendanceStats.present}</div>
                    <div className="text-sm font-medium text-gray-700">حاضر</div>
                    <div className="text-xs text-gray-500 mt-1">جلسه</div>
                </div>
                <div className="attendance-stats-card text-center">
                    <div className="text-2xl font-bold text-red-600 mb-2">{attendanceStats.absent}</div>
                    <div className="text-sm font-medium text-gray-700">غایب</div>
                    <div className="text-xs text-gray-500 mt-1">جلسه</div>
                </div>
                <div className="attendance-stats-card text-center">
                    <div className="text-2xl font-bold text-yellow-600 mb-2">{attendanceStats.late}</div>
                    <div className="text-sm font-medium text-gray-700">تأخیر</div>
                    <div className="text-xs text-gray-500 mt-1">جلسه</div>
                </div>
                <div className="attendance-stats-card text-center">
                    <div className="text-2xl font-bold text-blue-600 mb-2">{attendanceStats.excused}</div>
                    <div className="text-sm font-medium text-gray-700">معذور</div>
                    <div className="text-xs text-gray-500 mt-1">جلسه</div>
                </div>
            </div>

            {/* نمودار وضعیت حضور */}
            <Card>
                <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">وضعیت حضور شما</h3>
                <div className="space-y-6">
                    <div className="flex items-center justify-between">
                        <span className="text-gray-700 font-medium">درصد حضور کلی:</span>
                        <div className="flex items-center space-x-4 space-x-reverse">
                            <span className="text-2xl font-bold text-green-600">{attendanceStats.percentage}%</span>
                            <div className="w-48 bg-gray-200 rounded-full h-3">
                                <div 
                                    className="bg-green-500 h-3 rounded-full transition-all duration-500"
                                    style={{ width: `${attendanceStats.percentage}%` }}
                                ></div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="space-y-4">
                            <h4 className="font-medium text-gray-800 metallic-text">توزیع وضعیت حضور</h4>
                            <div className="space-y-3">
                                <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                    <span className="text-sm text-gray-700">حاضر:</span>
                                    <span className="font-medium text-green-600">{attendanceStats.present} جلسه</span>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                    <span className="text-sm text-gray-700">غایب:</span>
                                    <span className="font-medium text-red-600">{attendanceStats.absent} جلسه</span>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                    <span className="text-sm text-gray-700">تأخیر:</span>
                                    <span className="font-medium text-yellow-600">{attendanceStats.late} جلسه</span>
                                </div>
                                <div className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                    <span className="text-sm text-gray-700">معذور:</span>
                                    <span className="font-medium text-blue-600">{attendanceStats.excused} جلسه</span>
                                </div>
                            </div>
                        </div>
                        
                        <div className="space-y-4">
                            <h4 className="font-medium text-gray-800 metallic-text">نکات مهم</h4>
                            <ul className="text-sm text-gray-600 space-y-3">
                                <li className="flex items-start">
                                    <i className="fas fa-info-circle text-blue-500 ml-2 mt-1"></i>
                                    <span>حضور و غیاب توسط مدرس ثبت می‌شود</span>
                                </li>
                                <li className="flex items-start">
                                    <i className="fas fa-info-circle text-blue-500 ml-2 mt-1"></i>
                                    <span>در صورت عدم حضور، با مدرس هماهنگ کنید</span>
                                </li>
                                <li className="flex items-start">
                                    <i className="fas fa-info-circle text-blue-500 ml-2 mt-1"></i>
                                    <span>حداقل حضور مورد نیاز برای قبولی: 80%</span>
                                </li>
                                <li className="flex items-start">
                                    <i className="fas fa-info-circle text-blue-500 ml-2 mt-1"></i>
                                    <span>وضعیت شما: {attendanceStats.percentage >= 80 ? 'قابل قبول' : 'نیازمند بهبود'}</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </Card>

            {/* تاریخچه حضور و غیاب */}
            <Card>
                <div className="flex justify-between items-center mb-4">
                    <h3 className="text-lg font-semibold text-gray-800 metallic-text">تاریخچه حضور و غیاب</h3>
                    <span className="text-sm text-gray-500">
                        مجموع: {studentAttendance.length} جلسه
                    </span>
                </div>
                
                {studentAttendance.length > 0 ? (
                    <div className="overflow-x-auto">
                        <table className="attendance-table">
                            <thead>
                                <tr>
                                    <th>تاریخ</th>
                                    <th>کلاس</th>
                                    <th className="text-center">وضعیت</th>
                                    <th>ثبت شده توسط</th>
                                    <th>توضیحات</th>
                                </tr>
                            </thead>
                            <tbody>
                                {studentAttendance.map(record => {
                                    const classInfo = classes.find(c => c.id === record.classId);
                                    const weekday = PersianDateUtils.getPersianWeekday(...record.date.split('/'));
                                    
                                    return (
                                        <tr key={record.id}>
                                            <td>
                                                <div className="font-medium text-gray-800">
                                                    {record.date}
                                                </div>
                                                <div className="text-sm text-gray-500">
                                                    {weekday}
                                                </div>
                                            </td>
                                            <td className="text-gray-600">
                                                {classInfo?.name || 'نامشخص'}
                                            </td>
                                            <td className="text-center">
                                                {getStatusBadge(record.status)}
                                            </td>
                                            <td className="text-gray-600">
                                                {record.recordedBy}
                                            </td>
                                            <td className="text-gray-600">
                                                {record.notes || '---'}
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                    </div>
                ) : (
                    <div className="text-center py-12">
                        <i className="fas fa-user-check text-4xl text-gray-400 mb-4"></i>
                        <h3 className="text-lg font-medium text-gray-800 mb-2">هنوز اطلاعات حضور و غیاب ثبت نشده است</h3>
                        <p className="text-gray-600 max-w-md mx-auto">
                            اطلاعات حضور و غیاب شما پس از ثبت توسط مدرس در اینجا نمایش داده می‌شود
                        </p>
                    </div>
                )}
            </Card>

            {/* راهنمای وضعیت‌ها */}
            <Card>
                <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">راهنمای وضعیت‌ها</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div className="space-y-4">
                        <div className="flex items-center p-4 bg-green-50 rounded-lg border-r-4 border-green-500">
                            <div className="flex-shrink-0 w-12 h-12 bg-green-100 rounded-full flex items-center justify-center ml-3">
                                <i className="fas fa-check text-green-600 text-lg"></i>
                            </div>
                            <div>
                                <h4 className="font-medium text-green-800">حاضر</h4>
                                <p className="text-sm text-green-600 mt-1">شما در کلاس حضور کامل داشته‌اید</p>
                            </div>
                        </div>
                        
                        <div className="flex items-center p-4 bg-red-50 rounded-lg border-r-4 border-red-500">
                            <div className="flex-shrink-0 w-12 h-12 bg-red-100 rounded-full flex items-center justify-center ml-3">
                                <i className="fas fa-times text-red-600 text-lg"></i>
                            </div>
                            <div>
                                <h4 className="font-medium text-red-800">غایب</h4>
                                <p className="text-sm text-red-600 mt-1">شما در کلاس حضور نداشته‌اید</p>
                            </div>
                        </div>
                    </div>
                    
                    <div className="space-y-4">
                        <div className="flex items-center p-4 bg-yellow-50 rounded-lg border-r-4 border-yellow-500">
                            <div className="flex-shrink-0 w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center ml-3">
                                <i className="fas fa-clock text-yellow-600 text-lg"></i>
                            </div>
                            <div>
                                <h4 className="font-medium text-yellow-800">تأخیر</h4>
                                <p className="text-sm text-yellow-600 mt-1">شما با تأخیر در کلاس حاضر شده‌اید</p>
                            </div>
                        </div>
                        
                        <div className="flex items-center p-4 bg-blue-50 rounded-lg border-r-4 border-blue-500">
                            <div className="flex-shrink-0 w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center ml-3">
                                <i className="fas fa-user-clock text-blue-600 text-lg"></i>
                            </div>
                            <div>
                                <h4 className="font-medium text-blue-800">معذور</h4>
                                <p className="text-sm text-blue-600 mt-1">غیبت شما موجه و با مجوز است</p>
                            </div>
                        </div>
                    </div>
                </div>
            </Card>
        </div>
    );
};


        // =============================================
        // DEVELOPER: بخش تقویم جلالی - کاملاً اصلاح شده
        // =============================================
     
 

   const CalendarView = () => {
            const { calendarEvents, addCalendarEvent, updateCalendarEvent, deleteCalendarEvent, showNotification } = useStudentStore();
            
            const [selectedDate, setSelectedDate] = React.useState(null);
            const [showEventModal, setShowEventModal] = React.useState(false);
            const [editingEvent, setEditingEvent] = React.useState(null);
            const [eventForm, setEventForm] = React.useState({
                title: '',
                description: '',
                date: '',
                time: '',
                type: 'class'
            });

            const handleDateSelect = (date) => {
                setSelectedDate(date);
                const persianDate = `${date.jy}/${date.jm.toString().padStart(2, '0')}/${date.jd.toString().padStart(2, '0')}`;
                setEventForm(prev => ({
                    ...prev,
                    date: persianDate
                }));
                setShowEventModal(true);
            };

            const handleSaveEvent = () => {
                if (!eventForm.title.trim()) {
                    showNotification('لطفا عنوان رویداد را وارد کنید', 'error');
                    return;
                }

                // تبدیل تاریخ فارسی به فرمت استاندارد
                const gregorianDate = PersianDateUtils.toGregorianDate(eventForm.date);
                if (!gregorianDate) {
                    showNotification('تاریخ وارد شده معتبر نیست', 'error');
                    return;
                }

                const eventData = {
                    ...eventForm,
                    date: gregorianDate
                };

                if (editingEvent) {
                    updateCalendarEvent(editingEvent.id, eventData);
                    showNotification('رویداد به‌روزرسانی شد', 'success');
                } else {
                    addCalendarEvent(eventData);
                    showNotification('رویداد جدید اضافه شد', 'success');
                }

                setShowEventModal(false);
                setEventForm({
                    title: '',
                    description: '',
                    date: '',
                    time: '',
                    type: 'class'
                });
                setEditingEvent(null);
            };

            const handleEditEvent = (event) => {
                setEditingEvent(event);
                // تبدیل تاریخ به فرمت فارسی برای نمایش
                const persianDate = PersianDateUtils.toPersianDate(event.date);
                setEventForm({
                    title: event.title,
                    description: event.description || '',
                    date: persianDate,
                    time: event.time || '',
                    type: event.type || 'class'
                });
                setShowEventModal(true);
            };

            const handleDeleteEvent = (eventId) => {
                if (window.confirm('آیا از حذف این رویداد اطمینان دارید؟')) {
                    deleteCalendarEvent(eventId);
                }
            };

            const eventTypes = {
                class: { color: 'bg-blue-100 text-blue-800', label: 'کلاس' },
                exam: { color: 'bg-red-100 text-red-800', label: 'آزمون' },
                assignment: { color: 'bg-yellow-100 text-yellow-800', label: 'تکلیف' },
                personal: { color: 'bg-green-100 text-green-800', label: 'شخصی' }
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">تقویم آموزشی</h2>
                            <p className="text-gray-600 mt-1">مدیریت رویدادها و برنامه‌های درسی</p>
                        </div>
                        <Button 
                            variant="primary"
                            icon="fa-plus"
                            onClick={() => {
                                setEditingEvent(null);
                                setEventForm({
                                    title: '',
                                    description: '',
                                    date: PersianDateUtils.getCurrentPersianDate(),
                                    time: '',
                                    type: 'class'
                                });
                                setShowEventModal(true);
                            }}
                            aria-label="افزودن رویداد جدید"
                        >
                            افزودن رویداد
                        </Button>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2">
                            <JalaaliCalendar 
                                onDateSelect={handleDateSelect}
                                events={calendarEvents}
                            />
                        </div>

                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">رویدادهای آینده</h3>
                            <div className="space-y-3 max-h-96 overflow-y-auto">
                                {calendarEvents
                                    .filter(event => {
                                        try {
                                            const eventDate = new Date(event.date);
                                            return eventDate >= new Date();
                                        } catch (e) {
                                            return false;
                                        }
                                    })
                                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                                    .slice(0, 5)
                                    .map(event => {
                                        const typeInfo = eventTypes[event.type] || eventTypes.class;
                                        const persianDate = PersianDateUtils.toPersianDate(event.date);
                                        
                                        return (
                                            <div 
                                                key={event.id} 
                                                className="p-3 bg-gray-50 rounded-lg border-r-4 border-blue-500"
                                            >
                                                <div className="flex justify-between items-start mb-2">
                                                    <h4 className="font-medium text-gray-800">{event.title}</h4>
                                                    <span className={`metal-badge px-2 py-1 text-xs rounded-full ${typeInfo.color}`}>
                                                        {typeInfo.label}
                                                    </span>
                                                </div>
                                                <p className="text-sm text-gray-600 mb-2">
                                                    {event.description}
                                                </p>
                                                <div className="flex justify-between items-center text-xs text-gray-500">
                                                    <span>{persianDate} {event.time && `- ${event.time}`}</span>
                                                    <div className="flex space-x-2">
                                                        <button
                                                            onClick={() => handleEditEvent(event)}
                                                            className="text-blue-600 hover:text-blue-800"
                                                            aria-label="ویرایش رویداد"
                                                        >
                                                            <i className="fas fa-edit"></i>
                                                        </button>
                                                        <button
                                                            onClick={() => handleDeleteEvent(event.id)}
                                                            className="text-red-600 hover:text-red-800"
                                                            aria-label="حذف رویداد"
                                                        >
                                                            <i className="fas fa-trash-alt"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                {calendarEvents.filter(event => {
                                    try {
                                        const eventDate = new Date(event.date);
                                        return eventDate >= new Date();
                                    } catch (e) {
                                        return false;
                                    }
                                }).length === 0 && (
                                    <div className="text-center py-4 text-gray-500">
                                        <i className="fas fa-calendar-plus text-2xl mb-2"></i>
                                        <p>هیچ رویداد آینده‌ای وجود ندارد</p>
                                    </div>
                                )}
                            </div>
                        </Card>
                    </div>

                    {/* Modal برای افزودن/ویرایش رویداد */}
                    {showEventModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl p-6 w-full max-w-md">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">
                                    {editingEvent ? 'ویرایش رویداد' : 'رویداد جدید'}
                                </h3>
                                
                                <div className="space-y-4">
                                    <FormInput
                                        label="عنوان رویداد"
                                        value={eventForm.title}
                                        onChange={(e) => setEventForm({...eventForm, title: e.target.value})}
                                        required
                                    />
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                                            تاریخ
                                        </label>
                                        <PersianDateInput
                                            value={eventForm.date}
                                            onChange={(date) => setEventForm({...eventForm, date})}
                                            required
                                        />
                                    </div>
                                    
                                    <FormInput
                                        label="زمان (اختیاری)"
                                        value={eventForm.time}
                                        onChange={(e) => setEventForm({...eventForm, time: e.target.value})}
                                        placeholder="مثال: ۱۴:۰۰"
                                    />
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                                            نوع رویداد
                                        </label>
                                        <select
                                            value={eventForm.type}
                                            onChange={(e) => setEventForm({...eventForm, type: e.target.value})}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        >
                                            <option value="class">کلاس</option>
                                            <option value="exam">آزمون</option>
                                            <option value="assignment">تکلیف</option>
                                            <option value="personal">شخصی</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                                            توضیحات (اختیاری)
                                        </label>
                                        <textarea
                                            value={eventForm.description}
                                            onChange={(e) => setEventForm({...eventForm, description: e.target.value})}
                                            rows="3"
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                            placeholder="توضیحات مربوط به رویداد..."
                                        ></textarea>
                                    </div>
                                </div>
                                
                                <div className="flex space-x-3 space-x-reverse justify-end mt-6">
                                    <Button 
                                        variant="outline"
                                        onClick={() => setShowEventModal(false)}
                                        aria-label="انصراف"
                                    >
                                        انصراف
                                    </Button>
                                    <Button 
                                        variant="primary"
                                        onClick={handleSaveEvent}
                                        aria-label="ذخیره رویداد"
                                    >
                                        {editingEvent ? 'به‌روزرسانی' : 'ذخیره'}
                                    </Button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // =============================================
        // DEVELOPER: بخش جدید - سرفصل‌های آموزشی
        // این بخش کاملاً قابل توسعه است
        // =============================================
        const EducationalContent = () => {
            const { educationalContent, updateEducationalContent, addEducationalItem, showNotification } = useStudentStore();
            
            const [expandedNodes, setExpandedNodes] = React.useState(new Set());
            const [selectedCourse, setSelectedCourse] = React.useState(null);
            const [editingItem, setEditingItem] = React.useState(null);
            const [newItemForm, setNewItemForm] = React.useState({
                title: '',
                type: 'chapter',
                description: '',
                duration: '',
                status: 'not-started'
            });

            // داده‌های کامل دروس
            const coursesData = {
                // دروس اختصاصی
                'technical-drawing': {
                    title: 'مبانی نقشه کشی با رایانه',
                    icon: 'fas fa-drafting-compass',
                    gradient: 'var(--gradient-1)',
                    description: 'این درس به آموزش اصول پایه نقشه‌کشی فنی و استفاده از نرم‌افزارهای CAD در طراحی قطعات خودرو می‌پردازد.',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-1);">
                                    <i class="fas fa-drafting-compass"></i>
                                </div>
                                <div>
                                    <div class="detail-title">مبانی نقشه کشی با رایانه</div>
                                    <div class="detail-subtitle">درس تخصصی رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس جامع به آموزش کامل اصول نقشه‌کشی فنی و استفاده از نرم‌افزارهای CAD در طراحی قطعات خودرو می‌پردازد. دانش‌آموزان با مفاهیم پایه نقشه‌کشی، استانداردهای فنی و نرم‌افزارهای تخصصی آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson1.html" class="learning-link">
                                                    آشنایی با اصول و مبانی نقشه‌کشی فنی و استانداردهای اولیه
                                                    <span class="link-description">(پودمان اول - مفاهیم پایه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson2.html" class="learning-link">
                                                    تسلط بر مهارت نقشه‌خوانی و تجسم سه‌بعدی از نقشه‌های دو بعدی
                                                    <span class="link-description">(پودمان دوم - نقشه‌خوانی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson3.html" class="learning-link">
                                                    آموزش مفاهیم تقارن و تکنیک‌های مختلف برش در نقشه‌کشی
                                                    <span class="link-description">(پودمان سوم - برش و تقارن)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson4.html" class="learning-link">
                                                    تسلط بر ترسیم دست آزاد (اسکیس) و مهندسی معکوس
                                                    <span class="link-description">(پودمان چهارم - ترسیم دست آزاد)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson5.html" class="learning-link">
                                                    تسلط بر نرم‌افزارهای CAD تخصصی
                                                    <span class="link-description">(پودمان پنجم - تمرینات نرم‌افزاری)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">اهداف آموزشی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson5.html" class="learning-link">
                                                    توانایی ترسیم نقشه‌های فنی دقیق
                                                    <span class="link-description">(مفاهیم پایه و استانداردها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson6.html" class="learning-link">
                                                    تسلط بر نرم‌افزارهای CAD تخصصی
                                                    <span class="link-description">(نقشه‌خوانی و تجسم سه‌بعدی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson7.html" class="learning-link">
                                                    درک استانداردهای صنعتی
                                                    <span class="link-description">(برش، تقارن و هاشورزنی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson8.html" class="learning-link">
                                                    طراحی قطعات خودرو به صورت حرفه‌ای
                                                    <span class="link-description">(ترسیم دست آزاد و مهندسی معکوس)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">محتوای عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson9.html" class="learning-link">
                                                    پروژه طراحی سیستم تعلیق
                                                    <span class="link-description">(تحلیل هندسه و نقاط اتصال)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson10.html" class="learning-link">
                                                    مدل‌سازی موتور چهارسیلندر
                                                    <span class="link-description">(اصول اولیه و استانداردها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson11.html" class="learning-link">
                                                    طراحی قطعات بدنه خودرو
                                                    <span class="link-description">(ترسیم دست آزاد و مهندسی معکوس)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="AutoCAD-M10/Autocad-Lesson12.html" class="learning-link">
                                                    آنالیز استاتیکی قطعات
                                                    <span class="link-description">(برش و تحلیل مقاطع)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },
                'maintenance': {
                    title: 'مبانی سرویس و نگهداری موتور',
                    icon: 'fas fa-oil-can',
                    gradient: 'var(--gradient-3)',
                    description: 'آموزش سرویس‌های دوره‌ای، تعویض قطعات و نگهداری پیشگیرانه از موتور خودرو',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-3);">
                                    <i class="fas fa-oil-can"></i>
                                </div>
                                <div>
                                    <div class="detail-title">مبانی سرویس و نگهداری موتور</div>
                                    <div class="detail-subtitle">درس تخصصی رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش جامع سرویس‌های دوره‌ای، تعویض قطعات و نگهداری پیشگیرانه از موتور خودرو می‌پردازد. دانش‌آموزان با سیستم‌های مختلف موتور و روش‌های نگهداری صحیح آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="car-maintenance/module1-basic-maintenance.html" class="learning-link">
                                                    اصول سرویس‌های دوره‌ای موتور
                                                    <span class="link-description">(پودمان اول - سرویس‌های پایه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های روان‌کاری و خنک‌کنندگی
                                                    <span class="link-description">(پودمان دوم - سیستم‌های کمکی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعویض فیلترها و روغن‌ها
                                                    <span class="link-description">(پودمان سوم - تعمیرات دوره‌ای)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تنظیم سیستم‌های جرقه و سوخت
                                                    <span class="link-description">(پودمان چهارم - سیستم‌های احتراق)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    نگهداری پیشگیرانه
                                                    <span class="link-description">(پودمان پنجم - پیشگیری و نگهداری)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">ابزارهای مورد نیاز</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    ست آچارهای متریک
                                                    <span class="link-description">(ابزارهای پایه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    دستگاه دیاگ موتور
                                                    <span class="link-description">(ابزارهای تشخیصی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    کیت اندازه‌گیری فاصله سوپاپ
                                                    <span class="link-description">(ابزارهای تخصصی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تست‌ر فشار سیلندر
                                                    <span class="link-description">(ابزارهای اندازه‌گیری)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">پروژه‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سرویس کامل موتور چهارزمانه
                                                    <span class="link-description">(پروژه عملی اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعویض تسمه تایم
                                                    <span class="link-description">(پروژه عملی دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تنظیم سوپاپ‌ها
                                                    <span class="link-description">(پروژه عملی سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    عیب‌یابی سیستم جرقه
                                                    <span class="link-description">(پروژه عملی چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },
                'repairs': {
                    title: 'مبانی تعمیرات خودرو و موتور',
                    icon: 'fas fa-tools',
                    gradient: 'var(--gradient-4)',
                    description: 'عیب‌یابی، تعمیر و بازسازی موتور و سیستم‌های مختلف خودرو',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-4);">
                                    <i class="fas fa-tools"></i>
                                </div>
                                <div>
                                    <div class="detail-title">مبانی تعمیرات خودرو و موتور</div>
                                    <div class="detail-subtitle">درس تخصصی رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس پیشرفته به آموزش تخصصی عیب‌یابی، تعمیر و بازسازی موتور و سیستم‌های مختلف خودرو می‌پردازد. دانش‌آموزان با جدیدترین تکنیک‌های تعمیراتی آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول عیب‌یابی سیستم‌های موتور
                                                    <span class="link-description">(پودمان اول - عیب‌یابی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعمیرات پیشرفته موتور
                                                    <span class="link-description">(پودمان دوم - تعمیرات موتور)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های انتقال قدرت
                                                    <span class="link-description">(پودمان سوم - انتقال قدرت)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعمیرات سیستم‌های برقی
                                                    <span class="link-description">(پودمان چهارم - سیستم برق)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بازسازی کامل خودرو
                                                    <span class="link-description">(پودمان پنجم - بازسازی)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">تجهیزات تخصصی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    دستگاه عیب‌یابی کامپیوتری
                                                    <span class="link-description">(تجهیزات مدرن)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    کیت بازسازی موتور
                                                    <span class="link-description">(ابزارهای تخصصی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تجهیزات اندازه‌گیری دقیق
                                                    <span class="link-description">(ابزارهای اندازه‌گیری)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    ابزارهای تعمیرات تخصصی
                                                    <span class="link-description">(ابزارهای پیشرفته)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">پروژه‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بازسازی کامل موتور
                                                    <span class="link-description">(پروژه عملی اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعمیر سیستم تعلیق
                                                    <span class="link-description">(پروژه عملی دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    عیب‌یابی سیستم برق خودرو
                                                    <span class="link-description">(پروژه عملی سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعمیر گیربکس
                                                    <span class="link-description">(پروژه عملی چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },

                // دروس پایه
                'technical-basics': {
                    title: 'دانش پایه فنی مکانیک',
                    icon: 'fas fa-brain',
                    gradient: 'var(--gradient-2)',
                    description: 'مبانی علمی و تئوری مکانیک، فیزیک خودرو و اصول اولیه عملکرد سیستم‌ها',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-2);">
                                    <i class="fas fa-brain"></i>
                                </div>
                                <div>
                                    <div class="detail-title">دانش پایه فنی مکانیک</div>
                                    <div class="detail-subtitle">درس پایه رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش مبانی علمی و تئوری مکانیک، فیزیک خودرو و اصول اولیه عملکرد سیستم‌ها می‌پردازد. دانش‌آموزان با اصول علمی پشت عملکرد خودروها آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    مکانیک کلاسیک و دینامیک
                                                    <span class="link-description">(پودمان اول - مکانیک)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    ترمودینامیک موتور
                                                    <span class="link-description">(پودمان دوم - ترمودینامیک)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول انتقال حرارت
                                                    <span class="link-description">(پودمان سوم - انتقال حرارت)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    مقاومت مصالح
                                                    <span class="link-description">(پودمان چهارم - مقاومت مصالح)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول سیالات
                                                    <span class="link-description">(پودمان پنجم - سیالات)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">مفاهیم کلیدی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    قوانین نیوتن در خودرو
                                                    <span class="link-description">(مکانیک کاربردی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول کار موتورهای احتراقی
                                                    <span class="link-description">(اصول موتور)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های انتقال قدرت
                                                    <span class="link-description">(انتقال قدرت)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول ترمز و فرمان
                                                    <span class="link-description">(سیستم‌های کنترلی)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">کاربردهای عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    محاسبات توان و گشتاور
                                                    <span class="link-description">(محاسبات پایه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    آنالیز سیستم تعلیق
                                                    <span class="link-description">(تحلیل سیستم‌ها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی عملکرد ترمزها
                                                    <span class="link-description">(سیستم ترمز)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    محاسبات راندمان موتور
                                                    <span class="link-description">(راندمان و بهره‌وری)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },
                'electronics': {
                    title: 'اصول الکترونیک خودرو',
                    icon: 'fas fa-bolt',
                    gradient: 'var(--gradient-1)',
                    description: 'آموزش سیستم‌های الکترونیکی و برق خودرو و عیب‌یابی مدارهای الکتریکی',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-1);">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <div class="detail-title">اصول الکترونیک خودرو</div>
                                    <div class="detail-subtitle">درس پایه رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش سیستم‌های الکترونیکی و برق خودرو و عیب‌یابی مدارهای الکتریکی می‌پردازد. دانش‌آموزان با مدارهای پیچیده خودروهای مدرن آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول برق و الکترونیک
                                                    <span class="link-description">(پودمان اول - اصول پایه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های شارژ و استارت
                                                    <span class="link-description">(پودمان دوم - سیستم شارژ)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    مدارهای روشنایی
                                                    <span class="link-description">(پودمان سوم - سیستم روشنایی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های کنترل الکترونیکی
                                                    <span class="link-description">(پودمان چهارم - کنترل الکترونیکی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    عیب‌یابی مدارهای برقی
                                                    <span class="link-description">(پودمان پنجم - عیب‌یابی)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">تجهیزات برقی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    باتری و دینام
                                                    <span class="link-description">(منابع انرژی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم جرقه‌زنی
                                                    <span class="link-description">(سیستم احتراق)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    کامپیوتر خودرو (ECU)
                                                    <span class="link-description">(سیستم کنترل)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سنسورها و عملگرها
                                                    <span class="link-description">(قطعات الکترونیکی)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">پروژه‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    نصب و راه‌اندازی سیستم صوتی
                                                    <span class="link-description">(پروژه عملی اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    عیب‌یابی مدار شارژ
                                                    <span class="link-description">(پروژه عملی دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعمیر سیستم روشنایی
                                                    <span class="link-description">(پروژه عملی سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی سنسورهای موتور
                                                    <span class="link-description">(پروژه عملی چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },
                'hydraulics': {
                    title: 'هیدرولیک و پنوماتیک',
                    icon: 'fas fa-tint',
                    gradient: 'var(--gradient-3)',
                    description: 'اصول سیستم‌های هیدرولیکی و پنوماتیکی در خودرو و ماشین‌آلات',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-3);">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div>
                                    <div class="detail-title">هیدرولیک و پنوماتیک</div>
                                    <div class="detail-subtitle">درس پایه رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش اصول سیستم‌های هیدرولیکی و پنوماتیکی در خودرو و ماشین‌آلات می‌پردازد. دانش‌آموزان با سیستم‌های قدرتی مبتنی بر سیالات آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول هیدرولیک صنعتی
                                                    <span class="link-description">(پودمان اول - هیدرولیک)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های پنوماتیکی
                                                    <span class="link-description">(پودمان دوم - پنوماتیک)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    پمپ‌ها و کمپرسورها
                                                    <span class="link-description">(پودمان سوم - تجهیزات)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیلندرها و عملگرها
                                                    <span class="link-description">(پودمان چهارم - عملگرها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    کنترل‌های هیدرولیکی
                                                    <span class="link-description">(پودمان پنجم - کنترل)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">کاربردها در خودرو</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم ترمز هیدرولیکی
                                                    <span class="link-description">(سیستم ترمز)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    فرمان هیدرولیک
                                                    <span class="link-description">(سیستم فرمان)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم تعلیق هوایی
                                                    <span class="link-description">(سیستم تعلیق)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    جک‌های هیدرولیکی
                                                    <span class="link-description">(سیستم‌های کمکی)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">پروژه‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعمیر سیستم ترمز
                                                    <span class="link-description">(پروژه عملی اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بازسازی پمپ هیدرولیک
                                                    <span class="link-description">(پروژه عملی دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    نصب سیستم پنوماتیک
                                                    <span class="link-description">(پروژه عملی سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    عیب‌یابی مدارهای هیدرولیکی
                                                    <span class="link-description">(پروژه عملی چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },

                // دروس عمومی
                'mathematics': {
                    title: 'ریاضیات پایه دهم',
                    icon: 'fas fa-square-root-alt',
                    gradient: 'var(--gradient-1)',
                    description: 'آموزش مفاهیم ریاضی کاربردی در مکانیک شامل جبر، هندسه و مثلثات',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-1);">
                                    <i class="fas fa-square-root-alt"></i>
                                </div>
                                <div>
                                    <div class="detail-title">ریاضیات پایه دهم</div>
                                    <div class="detail-subtitle">درس عمومی رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش مفاهیم ریاضی کاربردی در مکانیک شامل جبر، هندسه و مثلثات می‌پردازد. تمرکز اصلی بر کاربردهای عملی ریاضی در صنعت خودرو است.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    جبر و معادلات
                                                    <span class="link-description">(پودمان اول - جبر)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    هندسه تحلیلی
                                                    <span class="link-description">(پودمان دوم - هندسه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    مثلثات کاربردی
                                                    <span class="link-description">(پودمان سوم - مثلثات)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    آمار و احتمال
                                                    <span class="link-description">(پودمان چهارم - آمار)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    حسابان مقدماتی
                                                    <span class="link-description">(پودمان پنجم - حسابان)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">کاربرد در مکانیک</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    محاسبات گشتاور و توان
                                                    <span class="link-description">(محاسبات موتور)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    آنالیز ابعادی قطعات
                                                    <span class="link-description">(آنالیز ابعاد)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    محاسبات دنده‌ها
                                                    <span class="link-description">(سیستم انتقال)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی نسبت‌های انتقال
                                                    <span class="link-description">(نسبت‌های دنده)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">تمرین‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    محاسبه حجم سیلندر
                                                    <span class="link-description">(تمرین عملی اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تعیین نسبت تراکم
                                                    <span class="link-description">(تمرین عملی دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    محاسبات سیستم تعلیق
                                                    <span class="link-description">(تمرین عملی سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی هندسی چرخ‌دنده‌ها
                                                    <span class="link-description">(تمرین عملی چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },
                'physics': {
                    title: 'فیزیک پایه دهم',
                    icon: 'fas fa-atom',
                    gradient: 'var(--gradient-2)',
                    description: 'مبانی فیزیک مکانیک، ترمودینامیک و الکتریسیته در کاربردهای خودرو',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-2);">
                                    <i class="fas fa-atom"></i>
                                </div>
                                <div>
                                    <div class="detail-title">فیزیک پایه دهم</div>
                                    <div class="detail-subtitle">درس عمومی رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش مبانی فیزیک مکانیک، ترمودینامیک و الکتریسیته در کاربردهای خودرو می‌پردازد. دانش‌آموزان با اصول فیزیکی حاکم بر عملکرد خودروها آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    مکانیک نیوتنی
                                                    <span class="link-description">(پودمان اول - مکانیک)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    ترمودینامیک
                                                    <span class="link-description">(پودمان دوم - ترمودینامیک)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    الکتریسیته و مغناطیس
                                                    <span class="link-description">(پودمان سوم - الکتریسیته)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    امواج و ارتعاشات
                                                    <span class="link-description">(پودمان چهارم - امواج)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    فیزیک مدرن مقدماتی
                                                    <span class="link-description">(پودمان پنجم - فیزیک مدرن)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">کاربرد در خودرو</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اصول حرکت و شتاب
                                                    <span class="link-description">(دینامیک خودرو)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تبدیل انرژی در موتور
                                                    <span class="link-description">(ترمودینامیک موتور)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سیستم‌های الکتریکی خودرو
                                                    <span class="link-description">(الکتریسیته کاربردی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    ارتعاشات و تعادل
                                                    <span class="link-description">(مکانیک ارتعاشات)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">آزمایش‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    اندازه‌گیری شتاب
                                                    <span class="link-description">(آزمایش اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی تبدیل انرژی
                                                    <span class="link-description">(آزمایش دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    آزمایش مدارهای الکتریکی
                                                    <span class="link-description">(آزمایش سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی ارتعاشات
                                                    <span class="link-description">(آزمایش چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                },
                'chemistry': {
                    title: 'شیمی پایه دهم',
                    icon: 'fas fa-flask',
                    gradient: 'var(--gradient-3)',
                    description: 'شیمی مواد، سوخت‌ها و روان‌کننده‌ها در صنعت خودرو',
                    content: `
                        <div class="course-detail-panel">
                            <div class="detail-header">
                                <div class="detail-icon" style="background: var(--gradient-3);">
                                    <i class="fas fa-flask"></i>
                                </div>
                                <div>
                                    <div class="detail-title">شیمی پایه دهم</div>
                                    <div class="detail-subtitle">درس عمومی رشته مکانیک خودرو - پایه دهم</div>
                                </div>
                            </div>
                            
                            <div class="detail-content">
                                <p>این درس به آموزش شیمی مواد، سوخت‌ها و روان‌کننده‌ها در صنعت خودرو می‌پردازد. دانش‌آموزان با خواص شیمیایی مواد مورد استفاده در خودروها آشنا می‌شوند.</p>
                            </div>

                            <div class="detail-sections">
                                <div class="detail-section">
                                    <div class="section-title-sm">سرفصل‌های اصلی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    شیمی آلی و معدنی
                                                    <span class="link-description">(پودمان اول - شیمی پایه)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    سوخت‌ها و احتراق
                                                    <span class="link-description">(پودمان دوم - سوخت‌ها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    روان‌کننده‌ها و مواد شیمیایی
                                                    <span class="link-description">(پودمان سوم - روان‌کننده‌ها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    خوردگی و حفاظت مواد
                                                    <span class="link-description">(پودمان چهارم - خوردگی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    شیمی پلیمرها
                                                    <span class="link-description">(پودمان پنجم - پلیمرها)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">مواد خودرو</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    آلیاژهای فلزی
                                                    <span class="link-description">(مواد فلزی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    پلاستیک‌ها و کامپوزیت‌ها
                                                    <span class="link-description">(مواد غیرفلزی)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    روغن‌ها و گریس‌ها
                                                    <span class="link-description">(روان‌کننده‌ها)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    مواد ضد یخ و ضد جوش
                                                    <span class="link-description">(مواد شیمیایی)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="detail-section">
                                    <div class="section-title-sm">آزمایش‌های عملی</div>
                                    <div class="section-content">
                                        <ul>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    تست کیفیت سوخت
                                                    <span class="link-description">(آزمایش اول)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    بررسی خوردگی فلزات
                                                    <span class="link-description">(آزمایش دوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    آزمایش روان‌کننده‌ها
                                                    <span class="link-description">(آزمایش سوم)</span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="#" class="learning-link" onclick="alert('این بخش در حال توسعه است')">
                                                    شناسایی مواد پلیمری
                                                    <span class="link-description">(آزمایش چهارم)</span>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-actions">
                                <button class="detail-btn" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-download"></i>
                                    دریافت محتوا
                                </button>
                                <button class="detail-btn primary" onclick="alert('این قابلیت به زودی اضافه خواهد شد')">
                                    <i class="fas fa-play"></i>
                                    شروع یادگیری
                                </button>
                            </div>
                        </div>
                    `
                }
            };

            React.useEffect(() => {
                // اگر محتوای آموزشی خالی است، ساختار اولیه ایجاد کن
                if (educationalContent.length === 0) {
                    const initialContent = [
                        {
                            id: 'course-1',
                            title: 'مکانیک خودرو پایه',
                            type: 'course',
                            description: 'دوره آموزشی مکانیک خودرو برای مبتدیان',
                            duration: '40 ساعت',
                            status: 'in-progress',
                            children: [
                                {
                                    id: 'chapter-1',
                                    title: 'فصل اول: آشنایی با موتورهای احتراق داخلی',
                                    type: 'chapter',
                                    description: 'مبانی اولیه موتورهای احتراق داخلی',
                                    duration: '8 ساعت',
                                    status: 'completed',
                                    children: [
                                        {
                                            id: 'lesson-1',
                                            title: 'انواع موتورهای احتراق داخلی',
                                            type: 'lesson',
                                            description: 'آشنایی با انواع موتورهای بنزینی و دیزلی',
                                            duration: '2 ساعت',
                                            status: 'completed'
                                        },
                                        {
                                            id: 'lesson-2',
                                            title: 'اجزای اصلی موتور',
                                            type: 'lesson',
                                            description: 'بررسی قطعات اصلی موتور خودرو',
                                            duration: '3 ساعت',
                                            status: 'in-progress'
                                        }
                                    ]
                                }
                            ]
                        }
                    ];
                    updateEducationalContent(initialContent);
                }
            }, [educationalContent, updateEducationalContent]);

            const toggleNode = (nodeId) => {
                setExpandedNodes(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(nodeId)) {
                        newSet.delete(nodeId);
                    } else {
                        newSet.add(nodeId);
                    }
                    return newSet;
                });
            };

            const handleAddItem = (parentId) => {
                if (!newItemForm.title.trim()) {
                    showNotification('لطفا عنوان را وارد کنید', 'error');
                    return;
                }

                addEducationalItem(parentId, newItemForm);
                setNewItemForm({
                    title: '',
                    type: 'chapter',
                    description: '',
                    duration: '',
                    status: 'not-started'
                });
                setEditingItem(null);
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'completed': return 'bg-green-100 text-green-800';
                    case 'in-progress': return 'bg-blue-100 text-blue-800';
                    case 'not-started': return 'bg-gray-100 text-gray-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            };

            const getStatusText = (status) => {
                switch (status) {
                    case 'completed': return 'تکمیل شده';
                    case 'in-progress': return 'در حال یادگیری';
                    case 'not-started': return 'شروع نشده';
                    default: return 'شروع نشده';
                }
            };

            const getTypeIcon = (type) => {
                switch (type) {
                    case 'course': return 'fas fa-book text-purple-500';
                    case 'chapter': return 'fas fa-folder text-blue-500';
                    case 'lesson': return 'fas fa-file-alt text-green-500';
                    default: return 'fas fa-file text-gray-500';
                }
            };

            const renderContentTree = (contents, level = 0) => {
                return contents.map(content => (
                    <div key={content.id} className="content-node">
                        <div 
                            className={`content-header ${expandedNodes.has(content.id) ? 'active' : ''}`}
                            style={{ paddingRight: `${level * 1.5 + 1}rem` }}
                            onClick={() => toggleNode(content.id)}
                        >
                            <div className="flex items-center">
                                <div className={`content-icon ${getStatusColor(content.status).replace('text', 'bg').replace('bg-', 'bg-')}`}>
                                    <i className={getTypeIcon(content.type)}></i>
                                </div>
                                <div>
                                    <h4 className="font-medium text-gray-800 metallic-text">{content.title}</h4>
                                    <p className="text-sm text-gray-600">{content.description}</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-2">
                                <span className={`content-badge ${getStatusColor(content.status)}`}>
                                    {getStatusText(content.status)}
                                </span>
                                {content.duration && (
                                    <span className="text-xs text-gray-500">{content.duration}</span>
                                )}
                                {content.children && content.children.length > 0 && (
                                    <i className={`fas fa-chevron-${expandedNodes.has(content.id) ? 'up' : 'down'} text-gray-400`}></i>
                                )}
                            </div>
                        </div>
                        
                        {content.children && content.children.length > 0 && (
                            <div className={`content-children ${expandedNodes.has(content.id) ? 'expanded' : ''}`}>
                                {renderContentTree(content.children, level + 1)}
                                
                                {/* دکمه افزودن محتوای جدید */}
                                <div className="p-3 border-t border-gray-200">
                                    {editingItem === content.id ? (
                                        <div className="space-y-3 p-3 bg-gray-50 rounded-lg">
                                            <FormInput
                                                label="عنوان"
                                                value={newItemForm.title}
                                                onChange={(e) => setNewItemForm({...newItemForm, title: e.target.value})}
                                                placeholder="عنوان محتوای جدید"
                                            />
                                            <div className="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                                                        نوع
                                                    </label>
                                                    <select
                                                        value={newItemForm.type}
                                                        onChange={(e) => setNewItemForm({...newItemForm, type: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                    >
                                                        <option value="chapter">فصل</option>
                                                        <option value="lesson">درس</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">
                                                        وضعیت
                                                    </label>
                                                    <select
                                                        value={newItemForm.status}
                                                        onChange={(e) => setNewItemForm({...newItemForm, status: e.target.value})}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                    >
                                                        <option value="not-started">شروع نشده</option>
                                                        <option value="in-progress">در حال یادگیری</option>
                                                        <option value="completed">تکمیل شده</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <FormInput
                                                label="مدت زمان (اختیاری)"
                                                value={newItemForm.duration}
                                                onChange={(e) => setNewItemForm({...newItemForm, duration: e.target.value})}
                                                placeholder="مثال: 2 ساعت"
                                            />
                                            <FormInput
                                                label="توضیحات (اختیاری)"
                                                value={newItemForm.description}
                                                onChange={(e) => setNewItemForm({...newItemForm, description: e.target.value})}
                                                placeholder="توضیحات مختصر"
                                            />
                                            <div className="flex space-x-2 justify-end">
                                                <Button
                                                    variant="outline"
                                                    size="sm"
                                                    onClick={() => setEditingItem(null)}
                                                >
                                                    انصراف
                                                </Button>
                                                <Button
                                                    variant="primary"
                                                    size="sm"
                                                    onClick={() => handleAddItem(content.id)}
                                                >
                                                    افزودن
                                                </Button>
                                            </div>
                                        </div>
                                    ) : (
                                        <Button
                                            variant="outline"
                                            size="sm"
                                            icon="fa-plus"
                                            onClick={() => {
                                                setEditingItem(content.id);
                                                setNewItemForm({
                                                    title: '',
                                                    type: 'chapter',
                                                    description: '',
                                                    duration: '',
                                                    status: 'not-started'
                                                });
                                            }}
                                        >
                                            افزودن محتوای جدید
                                        </Button>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                ));
            };

            const renderCourseDetail = (courseKey) => {
                const course = coursesData[courseKey];
                if (!course) return null;

                return (
                    <div 
                        className="course-detail-content"
                        dangerouslySetInnerHTML={{ __html: course.content }}
                    />
                );
            };

            const renderCoursesGrid = () => {
                const courseCategories = {
                    'دروس اختصاصی': ['technical-drawing', 'maintenance', 'repairs'],
                    'دروس پایه': ['technical-basics', 'electronics', 'hydraulics'],
                    'دروس عمومی': ['mathematics', 'physics', 'chemistry']
                };

                return Object.entries(courseCategories).map(([category, courseKeys]) => (
                    <div key={category} className="mb-8">
                        <h3 className="text-xl font-bold text-gray-800 mb-4 border-b-2 border-blue-500 pb-2 metallic-text">
                            {category}
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {courseKeys.map(courseKey => {
                                const course = coursesData[courseKey];
                                return (
                                    <Card 
                                        key={courseKey} 
                                        hoverable={true}
                                        className="cursor-pointer transform transition-transform hover:scale-105"
                                        onClick={() => setSelectedCourse(courseKey)}
                                    >
                                        <div className="flex items-start mb-4">
                                            <div 
                                                className="flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center text-white text-xl"
                                                style={{ background: course.gradient }}
                                            >
                                                <i className={course.icon}></i>
                                            </div>
                                            <div className="mr-3 flex-1">
                                                <h3 className="text-lg font-semibold text-gray-800 metallic-text">{course.title}</h3>
                                                <p className="text-sm text-gray-600 mt-1 line-clamp-2">
                                                    {course.description}
                                                </p>
                                            </div>
                                        </div>
                                        
                                        <div className="flex justify-between items-center">
                                            <span className="text-xs text-gray-500">پایه دهم</span>
                                            <Button 
                                                variant="primary" 
                                                size="sm"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    setSelectedCourse(courseKey);
                                                }}
                                            >
                                                مشاهده جزئیات
                                            </Button>
                                        </div>
                                    </Card>
                                );
                            })}
                        </div>
                    </div>
                ));
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">سرفصل‌های آموزشی</h2>
                            <p className="text-gray-600 mt-1">مدیریت و پیگیری پیشرفت درسی</p>
                        </div>
                        <Button 
                            variant="primary"
                            icon="fa-sync-alt"
                            onClick={() => showNotification('سرفصل‌ها به‌روزرسانی شد', 'success')}
                        >
                            به‌روزرسانی
                        </Button>
                    </div>

                    {selectedCourse ? (
                        <div className="space-y-6">
                            <div className="flex items-center mb-4">
                                <Button 
                                    variant="outline"
                                    icon="fa-arrow-right"
                                    onClick={() => setSelectedCourse(null)}
                                    className="ml-4"
                                >
                                    بازگشت به لیست دروس
                                </Button>
                                <h3 className="text-xl font-bold text-gray-800 metallic-text">
                                    {coursesData[selectedCourse]?.title}
                                </h3>
                            </div>
                            {renderCourseDetail(selectedCourse)}
                        </div>
                    ) : (
                        <>
                            <Card>
                                <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">ساختار درسی</h3>
                                <div className="content-tree">
                                    {educationalContent.length > 0 ? (
                                        renderContentTree(educationalContent)
                                    ) : (
                                        <div className="text-center py-8 text-gray-500">
                                            <i className="fas fa-graduation-cap text-3xl mb-2"></i>
                                            <p>هیچ سرفصل آموزشی تعریف نشده است</p>
                                        </div>
                                    )}
                                </div>
                            </Card>

                            <Card>
                                <h3 className="text-lg font-semibold text-gray-800 mb-6 metallic-text">لیست دروس پایه دهم</h3>
                                {renderCoursesGrid()}
                            </Card>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="stat-card text-center">
                                    <div className="text-2xl font-bold text-green-600">
                                        {educationalContent.flatMap(c => c.children || []).filter(item => item.status === 'completed').length}
                                    </div>
                                    <div className="text-sm text-gray-600">فصل‌های تکمیل شده</div>
                                </div>
                                <div className="stat-card text-center">
                                    <div className="text-2xl font-bold text-blue-600">
                                        {educationalContent.flatMap(c => c.children || []).filter(item => item.status === 'in-progress').length}
                                    </div>
                                    <div className="text-sm text-gray-600">فصل‌های در حال یادگیری</div>
                                </div>
                                <div className="stat-card text-center">
                                    <div className="text-2xl font-bold text-gray-600">
                                        {educationalContent.flatMap(c => c.children || []).filter(item => item.status === 'not-started').length}
                                    </div>
                                    <div className="text-sm text-gray-600">فصل‌های شروع نشده</div>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        };


        // =============================================
        // DEVELOPER: سایر بخش‌های پنل
        // تمام این بخش‌ها کاملاً عملیاتی هستند
        // =============================================

        // بخش تکالیف (کاملاً عملیاتی)
        const AssignmentsManagement = () => {
            const { assignments, submissions, classes, currentStudent, addSubmission, showNotification } = useStudentStore();
            const [selectedAssignment, setSelectedAssignment] = React.useState(null);
            const [submissionContent, setSubmissionContent] = React.useState('');
            const [submissionFile, setSubmissionFile] = React.useState(null);

            // فیلتر کردن تکالیف مربوط به دانش‌آموز فعلی
            const studentAssignments = assignments.filter(assignment => {
                if (assignment.targets && assignment.targets.type === 'all') return true;
                return assignment.targets && assignment.targets.students && assignment.targets.students.includes(currentStudent.id);
            });

            const handleSubmitAssignment = (e) => {
                e.preventDefault();
                
                if (!submissionContent.trim()) {
                    showNotification('لطفا محتوای پاسخ را وارد کنید', 'error');
                    return;
                }

                const submission = {
                    assignmentId: selectedAssignment.id,
                    studentId: currentStudent.id,
                    content: submissionContent,
                    attachments: submissionFile ? [submissionFile.name] : []
                };

                addSubmission(submission);
                setSelectedAssignment(null);
                setSubmissionContent('');
                setSubmissionFile(null);
            };

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setSubmissionFile(file);
                }
            };

            const getSubmissionStatus = (assignment) => {
                const submission = submissions.find(s => s.assignmentId === assignment.id);
                const isOverdue = new Date(PersianDateUtils.toGregorianDate(assignment.dueDate)) < new Date();
                
                if (submission) {
                    return { status: 'submitted', submission, text: 'ارسال شده', color: 'green' };
                } else if (isOverdue) {
                    return { status: 'overdue', text: 'منقضی شده', color: 'red' };
                } else {
                    return { status: 'pending', text: 'در انتظار', color: 'yellow' };
                }
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">تکالیف من</h2>
                            <p className="text-gray-600 mt-1">مدیریت و ارسال تکالیف درسی</p>
                        </div>
                    </div>

                    {selectedAssignment && (
                        <Card className="fade-in">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">ارسال پاسخ برای {selectedAssignment.title}</h3>
                            <form onSubmit={handleSubmitAssignment}>
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2 metallic-text">
                                        محتوای پاسخ
                                    </label>
                                    <textarea
                                        value={submissionContent}
                                        onChange={(e) => setSubmissionContent(e.target.value)}
                                        rows="6"
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        placeholder="پاسخ خود را اینجا بنویسید..."
                                        required
                                    ></textarea>
                                </div>

                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2 metallic-text">
                                        فایل پیوست (اختیاری)
                                    </label>
                                    <input
                                        type="file"
                                        onChange={handleFileChange}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    />
                                    {submissionFile && (
                                        <p className="text-sm text-green-600 mt-2">
                                            فایل انتخاب شده: {submissionFile.name}
                                        </p>
                                    )}
                                </div>

                                <div className="flex space-x-3 space-x-reverse justify-end">
                                    <Button 
                                        type="button"
                                        variant="outline"
                                        onClick={() => setSelectedAssignment(null)}
                                        aria-label="انصراف از ارسال پاسخ"
                                    >
                                        انصراف
                                    </Button>
                                    <Button 
                                        type="submit"
                                        variant="primary"
                                        icon="fa-paper-plane"
                                        aria-label="ارسال پاسخ"
                                    >
                                        ارسال پاسخ
                                    </Button>
                                </div>
                            </form>
                        </Card>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {studentAssignments.map(assignment => {
                            const classInfo = classes.find(c => c.id === assignment.classId);
                            const status = getSubmissionStatus(assignment);
                            const canSubmit = status.status === 'pending';
                            
                            return (
                                <Card key={assignment.id} hoverable={true}>
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-lg font-semibold text-gray-800 metallic-text">{assignment.title}</h3>
                                        <span className={`metal-badge px-2 py-1 text-xs rounded-full ${
                                            status.color === 'green' ? 'bg-green-100 text-green-800' :
                                            status.color === 'red' ? 'bg-red-100 text-red-800' :
                                            'bg-yellow-100 text-yellow-800'
                                        }`}>
                                            {status.text}
                                        </span>
                                    </div>
                                    
                                    <p className="text-gray-600 mb-4 line-clamp-2">
                                        {assignment.description || 'بدون توضیحات'}
                                    </p>
                                    
                                    <div className="space-y-2 mb-4">
                                        <div className="flex justify-between">
                                            <span className="text-gray-500">کلاس:</span>
                                            <span className="font-medium">{classInfo?.name || 'نامشخص'}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-500">مهلت تحویل:</span>
                                            <span className="font-medium">{assignment.dueDate}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-500">حداکثر نمره:</span>
                                            <span className="font-medium">{assignment.maxScore}</span>
                                        </div>
                                        {status.submission && (
                                            <div className="flex justify-between">
                                                <span className="text-gray-500">نمره شما:</span>
                                                <span className="font-medium text-green-600">
                                                    {status.submission.grade}/{assignment.maxScore}
                                                </span>
                                            </div>
                                        )}
                                    </div>

                                    {assignment.attachments && assignment.attachments.length > 0 && (
                                        <div className="mb-4">
                                            <p className="text-sm text-gray-600 mb-2">فایل‌های ضمیمه:</p>
                                            <div className="space-y-1">
                                                {assignment.attachments.map((file, index) => (
                                                    <a
                                                        key={index}
                                                        href={`#download-${file}`}
                                                        className="flex items-center text-blue-600 hover:text-blue-800 text-sm"
                                                        onClick={(e) => {
                                                            e.preventDefault();
                                                            // شبیه‌سازی دانلود
                                                            const blob = new Blob(['محتویات فایل ' + file], { type: 'application/octet-stream' });
                                                            const url = URL.createObjectURL(blob);
                                                            const a = document.createElement('a');
                                                            a.href = url;
                                                            a.download = file;
                                                            document.body.appendChild(a);
                                                            a.click();
                                                            document.body.removeChild(a);
                                                            URL.revokeObjectURL(url);
                                                        }}
                                                    >
                                                        <i className="fas fa-download ml-1"></i>
                                                        {file}
                                                    </a>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    
                                    <div className="flex justify-between items-center pt-4 border-t border-gray-200">
                                        {canSubmit ? (
                                            <Button 
                                                variant="primary"
                                                size="sm"
                                                onClick={() => setSelectedAssignment(assignment)}
                                                aria-label={`ارسال پاسخ برای ${assignment.title}`}
                                            >
                                                ارسال پاسخ
                                            </Button>
                                        ) : status.submission ? (
                                            <div className="text-sm text-gray-600">
                                                ارسال شده در {new Date(status.submission.submittedAt).toLocaleDateString('fa-IR')}
                                            </div>
                                        ) : (
                                            <div className="text-sm text-red-600">
                                                زمان ارسال به پایان رسیده
                                            </div>
                                        )}
                                        <span className="text-xs text-gray-500">
                                            {assignment.dueDate}
                                        </span>
                                    </div>
                                </Card>
                            );
                        })}
                        
                        {studentAssignments.length === 0 && (
                            <div className="md:col-span-3 text-center py-12">
                                <div className="bg-gray-100 rounded-2xl p-8 max-w-md mx-auto">
                                    <i className="fas fa-tasks text-4xl text-gray-400 mb-4"></i>
                                    <h3 className="text-lg font-medium text-gray-800 mb-2">هیچ تکلیفی برای شما تعریف نشده است</h3>
                                    <p className="text-gray-600">
                                        تکالیف جدید به محض تعریف توسط مدرس در اینجا نمایش داده می‌شوند
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // بخش محتوای درسی (کاملاً عملیاتی)
        const ContentManagement = () => {
            const { courseContents, classes, currentStudent } = useStudentStore();
            
            // فیلتر کردن محتوای مربوط به کلاس دانش‌آموز
            const studentContents = courseContents.filter(content => 
                content.classId === currentStudent.classId
            );

            const contentTypes = {
                document: { icon: 'fa-file-pdf', color: 'bg-red-100 text-red-600', label: 'سند' },
                video: { icon: 'fa-video', color: 'bg-purple-100 text-purple-600', label: 'ویدیو' },
                audio: { icon: 'fa-music', color: 'bg-blue-100 text-blue-600', label: 'صوت' },
                link: { icon: 'fa-link', color: 'bg-green-100 text-green-600', label: 'لینک' },
                image: { icon: 'fa-image', color: 'bg-orange-100 text-orange-600', label: 'تصویر' }
            };

            const handleDownload = (content) => {
                if (content.attachments && content.attachments.length > 0) {
                    content.attachments.forEach(file => {
                        const blob = new Blob(['محتویات ' + file], { type: 'application/octet-stream' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = file;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    });
                }
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">محتوای درسی</h2>
                            <p className="text-gray-600 mt-1">منابع و محتوای آموزشی کلاس شما</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {studentContents.map(content => {
                            const classInfo = classes.find(c => c.id === content.classId);
                            const typeInfo = contentTypes[content.type] || contentTypes.document;
                            
                            return (
                                <Card key={content.id} hoverable={true}>
                                    <div className="flex justify-between items-start mb-4">
                                        <h3 className="text-lg font-semibold text-gray-800 metallic-text">{content.title}</h3>
                                        <div className={`p-2 rounded-lg ${typeInfo.color}`}>
                                            <i className={`fas ${typeInfo.icon}`}></i>
                                        </div>
                                    </div>
                                    
                                    <p className="text-gray-600 mb-4 line-clamp-3">
                                        {content.description || 'بدون توضیحات'}
                                    </p>
                                    
                                    <div className="space-y-2 mb-4">
                                        <div className="flex justify-between">
                                            <span className="text-gray-500">کلاس:</span>
                                            <span className="font-medium">{classInfo?.name || 'نامشخص'}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-gray-500">نوع:</span>
                                            <span className="font-medium">{typeInfo.label}</span>
                                        </div>
                                    </div>
                                    
                                    <div className="flex justify-between items-center pt-4 border-t border-gray-200">
                                        <button 
                                            className="text-sm text-blue-600 hover:text-blue-800 flex items-center"
                                            onClick={() => handleDownload(content)}
                                            aria-label={`دانلود ${content.title}`}
                                        >
                                            <i className="fas fa-download ml-1"></i>
                                            دانلود
                                        </button>
                                        <span className="text-xs text-gray-500">
                                            {new Date(content.createdAt).toLocaleDateString('fa-IR')}
                                        </span>
                                    </div>
                                </Card>
                            );
                        })}
                        
                        {studentContents.length === 0 && (
                            <div className="md:col-span-3 text-center py-12">
                                <div className="bg-gray-100 rounded-2xl p-8 max-w-md mx-auto">
                                    <i className="fas fa-book text-4xl text-gray-400 mb-4"></i>
                                    <h3 className="text-lg font-medium text-gray-800 mb-2">هنوز محتوایی برای کلاس شما اضافه نشده است</h3>
                                    <p className="text-gray-600">
                                        محتوای درسی به محض آماده شدن توسط مدرس در اینجا نمایش داده می‌شود
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // بخش جلسات (کاملاً عملیاتی)
        const SessionsManagement = () => {
            const { sessions, classes, currentStudent } = useStudentStore();
            
            // فیلتر کردن جلسات مربوط به کلاس دانش‌آموز
            const studentSessions = sessions.filter(session => 
                session.classId === currentStudent.classId
            );

            const upcomingSessions = studentSessions.filter(session => {
                const sessionDate = new Date(PersianDateUtils.toGregorianDate(session.date));
                return sessionDate >= new Date();
            });

            const pastSessions = studentSessions.filter(session => {
                const sessionDate = new Date(PersianDateUtils.toGregorianDate(session.date));
                return sessionDate < new Date();
            });

            const sessionTypes = {
                lecture: { color: 'bg-blue-100 text-blue-800', label: 'تدریس' },
                practice: { color: 'bg-green-100 text-green-800', label: 'عملی' },
                exam: { color: 'bg-red-100 text-red-800', label: 'آزمون' },
                review: { color: 'bg-purple-100 text-purple-800', label: 'مرور' }
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">جلسات کلاس</h2>
                            <p className="text-gray-600 mt-1">برنامه زمانی جلسات آموزشی</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">جلسات آینده</h3>
                            <div className="space-y-4">
                                {upcomingSessions.map(session => {
                                    const classInfo = classes.find(c => c.id === session.classId);
                                    const typeInfo = sessionTypes[session.type] || sessionTypes.lecture;
                                    
                                    return (
                                        <div key={session.id} className="flex items-center justify-between p-4 bg-blue-50 rounded-lg">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 w-12 h-12 bg-white rounded-lg flex items-center justify-center border border-blue-200">
                                                    <i className="fas fa-calendar-alt text-blue-600"></i>
                                                </div>
                                                <div className="mr-3">
                                                    <h4 className="font-medium text-gray-800">{session.title}</h4>
                                                    <p className="text-sm text-gray-600">
                                                        {classInfo?.name || 'کلاس'} - {session.date} - {session.time}
                                                    </p>
                                                </div>
                                            </div>
                                            <span className={`metal-badge px-2 py-1 text-xs rounded-full ${typeInfo.color}`}>
                                                {typeInfo.label}
                                            </span>
                                        </div>
                                    );
                                })}
                                {upcomingSessions.length === 0 && (
                                    <div className="text-center py-8 text-gray-500">
                                        <i className="fas fa-calendar-plus text-3xl mb-2"></i>
                                        <p>هیچ جلسه آینده‌ای برنامه‌ریزی نشده است</p>
                                    </div>
                                )}
                            </div>
                        </Card>

                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">جلسات گذشته</h3>
                            <div className="space-y-4">
                                {pastSessions.slice(0, 5).map(session => {
                                    const classInfo = classes.find(c => c.id === session.classId);
                                    const typeInfo = sessionTypes[session.type] || sessionTypes.lecture;
                                    
                                    return (
                                        <div key={session.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <div className="flex items-center">
                                                <div className="flex-shrink-0 w-10 h-10 bg-white rounded-lg flex items-center justify-center border border-gray-200">
                                                    <i className="fas fa-calendar-check text-gray-600"></i>
                                                </div>
                                                <div className="mr-3">
                                                    <h4 className="font-medium text-gray-800">{session.title}</h4>
                                                    <p className="text-sm text-gray-500">
                                                        {session.date} - {session.time}
                                                    </p>
                                                </div>
                                            </div>
                                            <span className={`metal-badge px-2 py-1 text-xs rounded-full ${typeInfo.color}`}>
                                                {typeInfo.label}
                                            </span>
                                        </div>
                                    );
                                })}
                                {pastSessions.length === 0 && (
                                    <div className="text-center py-8 text-gray-500">
                                        <i className="fas fa-calendar-check text-3xl mb-2"></i>
                                        <p>هیچ جلسه گذشته‌ای ثبت نشده است</p>
                                    </div>
                                )}
                            </div>
                        </Card>
                    </div>

                    <Card>
                        <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">آمار جلسات</h3>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <div className="text-2xl font-bold text-blue-600">{studentSessions.length}</div>
                                <div className="text-sm text-blue-500">کل جلسات</div>
                            </div>
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <div className="text-2xl font-bold text-green-600">{upcomingSessions.length}</div>
                                <div className="text-sm text-green-500">جلسات آینده</div>
                            </div>
                            <div className="text-center p-4 bg-orange-50 rounded-lg">
                                <div className="text-2xl font-bold text-orange-600">{pastSessions.length}</div>
                                <div className="text-sm text-orange-500">جلسات گذشته</div>
                            </div>
                            <div className="text-center p-4 bg-purple-50 rounded-lg">
                                <div className="text-2xl font-bold text-purple-600">
                                    {studentSessions.filter(s => s.type === 'exam').length}
                                </div>
                                <div className="text-sm text-purple-500">آزمون‌ها</div>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        // بخش نمرات (کاملاً عملیاتی)
        const GradesManagement = () => {
            const { grades, assignments, classes, currentStudent } = useStudentStore();
            
            // فیلتر کردن نمرات دانش‌آموز فعلی
            const studentGrades = grades.filter(grade => 
                grade.studentId === currentStudent.id
            );

            const calculateAverage = () => {
                if (studentGrades.length === 0) return 0;
                const total = studentGrades.reduce((sum, grade) => sum + grade.grade, 0);
                return (total / studentGrades.length).toFixed(1);
            };

            const getGradeColor = (grade, maxGrade) => {
                const percentage = (grade / maxGrade) * 100;
                if (percentage >= 85) return 'text-green-600';
                if (percentage >= 70) return 'text-blue-600';
                if (percentage >= 50) return 'text-yellow-600';
                return 'text-red-600';
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">نمرات و عملکرد</h2>
                            <p className="text-gray-600 mt-1">بررسی نمرات و وضعیت تحصیلی</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="stat-card">
                            <div className="text-center">
                                <div className="text-4xl font-bold text-blue-600 mb-2">{calculateAverage()}</div>
                                <div className="text-sm text-gray-600">میانگین نمرات</div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="text-center">
                                <div className="text-4xl font-bold text-green-600 mb-2">{studentGrades.length}</div>
                                <div className="text-sm text-gray-600">تعداد نمرات ثبت شده</div>
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="text-center">
                                <div className="text-4xl font-bold text-purple-600 mb-2">
                                    {studentGrades.filter(g => g.grade >= 10).length}
                                </div>
                                <div className="text-sm text-gray-600">تکالیف قبول شده</div>
                            </div>
                        </div>
                    </div>

                    <Card>
                        <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">لیست نمرات</h3>
                        
                        {studentGrades.length > 0 ? (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead>
                                        <tr className="bg-gray-50">
                                            <th className="py-3 px-4 text-right text-sm font-medium text-gray-700">تکلیف</th>
                                            <th className="py-3 px-4 text-right text-sm font-medium text-gray-700">کلاس</th>
                                            <th className="py-3 px-4 text-center text-sm font-medium text-gray-700">نمره</th>
                                            <th className="py-3 px-4 text-right text-sm font-medium text-gray-700">توضیحات</th>
                                            <th className="py-3 px-4 text-center text-sm font-medium text-gray-700">وضعیت</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {studentGrades.map(grade => {
                                            const assignment = assignments.find(a => a.id === grade.assignmentId);
                                            const classInfo = classes.find(c => c.id === grade.classId);
                                            const isPassed = grade.grade >= 10;
                                            
                                            return (
                                                <tr key={grade.id} className="hover:bg-gray-50 transition-colors">
                                                    <td className="py-3 px-4">
                                                        <div className="font-medium text-gray-800">
                                                            {assignment?.title || 'نامشخص'}
                                                        </div>
                                                    </td>
                                                    <td className="py-3 px-4 text-gray-600">
                                                        {classInfo?.name || 'نامشخص'}
                                                    </td>
                                                    <td className="py-3 px-4 text-center">
                                                        <span className={`font-bold ${getGradeColor(grade.grade, grade.maxGrade)}`}>
                                                            {grade.grade}/{grade.maxGrade}
                                                        </span>
                                                    </td>
                                                    <td className="py-3 px-4 text-gray-600">
                                                        {grade.comment || 'بدون توضیح'}
                                                    </td>
                                                    <td className="py-3 px-4 text-center">
                                                        <span className={`metal-badge px-2 py-1 text-xs rounded-full ${
                                                            isPassed 
                                                                ? 'bg-green-100 text-green-800'
                                                                : 'bg-red-100 text-red-800'
                                                        }`}>
                                                            {isPassed ? 'قبول' : 'مردود'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="text-center py-12">
                                <i className="fas fa-chart-bar text-4xl text-gray-400 mb-4"></i>
                                <h3 className="text-lg font-medium text-gray-800 mb-2">هنوز نمره‌ای ثبت نشده است</h3>
                                <p className="text-gray-600">
                                    نمرات شما پس از تصحیح تکالیف توسط مدرس در اینجا نمایش داده می‌شوند
                                </p>
                            </div>
                        )}
                    </Card>
                </div>
            );
        };

        // بخش اعلان‌ها (کاملاً عملیاتی)
        const NotificationsManagement = () => {
            const { notifications, markNotificationAsRead, markAllNotificationsAsRead } = useStudentStore();
            
            const unreadNotifications = notifications.filter(n => !n.read);
            const readNotifications = notifications.filter(n => n.read);

            const notificationTypes = {
                info: { icon: 'fa-info-circle', color: 'text-blue-500' },
                success: { icon: 'fa-check-circle', color: 'text-green-500' },
                warning: { icon: 'fa-exclamation-triangle', color: 'text-yellow-500' },
                error: { icon: 'fa-exclamation-circle', color: 'text-red-500' }
            };

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">اعلان‌ها</h2>
                            <p className="text-gray-600 mt-1">پیام‌ها و اطلاعیه‌های سیستم</p>
                        </div>
                        {unreadNotifications.length > 0 && (
                            <Button 
                                variant="primary"
                                icon="fa-check-double"
                                onClick={markAllNotificationsAsRead}
                                aria-label="علامت‌گذاری همه اعلان‌ها به عنوان خوانده شده"
                            >
                                خواندن همه
                            </Button>
                        )}
                    </div>

                    {unreadNotifications.length > 0 && (
                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">اعلان‌های جدید ({unreadNotifications.length})</h3>
                            <div className="space-y-3">
                                {unreadNotifications.map(notification => {
                                    const typeInfo = notificationTypes[notification.type] || notificationTypes.info;
                                    
                                    return (
                                        <div key={notification.id} className="flex items-start justify-between p-4 bg-blue-50 rounded-lg border-r-4 border-blue-500">
                                            <div className="flex items-start">
                                                <i className={`fas ${typeInfo.icon} ${typeInfo.color} ml-3 mt-1`}></i>
                                                <div>
                                                    <h4 className="font-medium text-gray-800">{notification.title}</h4>
                                                    <p className="text-gray-600 mt-1">{notification.message}</p>
                                                    <p className="text-sm text-gray-500 mt-2">
                                                        {new Date(notification.date).toLocaleDateString('fa-IR')}
                                                    </p>
                                                </div>
                                            </div>
                                            <button 
                                                onClick={() => markNotificationAsRead(notification.id)}
                                                className="text-blue-600 hover:text-blue-800 p-1"
                                                aria-label="علامت‌گذاری به عنوان خوانده شده"
                                            >
                                                <i className="fas fa-check"></i>
                                            </button>
                                        </div>
                                    );
                                })}
                            </div>
                        </Card>
                    )}

                    <Card>
                        <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">اعلان‌های خوانده شده</h3>
                        {readNotifications.length > 0 ? (
                            <div className="space-y-3">
                                {readNotifications.map(notification => {
                                    const typeInfo = notificationTypes[notification.type] || notificationTypes.info;
                                    
                                    return (
                                        <div key={notification.id} className="flex items-start p-4 bg-gray-50 rounded-lg">
                                            <i className={`fas ${typeInfo.icon} ${typeInfo.color} ml-3 mt-1`}></i>
                                            <div>
                                                <h4 className="font-medium text-gray-800">{notification.title}</h4>
                                                <p className="text-gray-600 mt-1">{notification.message}</p>
                                                <p className="text-sm text-gray-500 mt-2">
                                                    {new Date(notification.date).toLocaleDateString('fa-IR')}
                                                </p>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        ) : (
                            <div className="text-center py-8 text-gray-500">
                                <i className="fas fa-bell-slash text-3xl mb-2"></i>
                                <p>هیچ اعلان خوانده شده‌ای وجود ندارد</p>
                            </div>
                        )}
                    </Card>
                </div>
            );
        };

        // بخش پروفایل (کاملاً عملیاتی)
        const ProfileManagement = () => {
            const { currentStudent, classes, updateProfile, showNotification, exportData } = useStudentStore();
            const [editMode, setEditMode] = React.useState(false);
            const [formData, setFormData] = React.useState({
                name: currentStudent.name || '',
                email: currentStudent.email || '',
                phone: currentStudent.phone || ''
            });

            const handleSave = (e) => {
                e.preventDefault();
                updateProfile(formData);
                setEditMode(false);
            };

            const handleCancel = () => {
                setFormData({
                    name: currentStudent.name || '',
                    email: currentStudent.email || '',
                    phone: currentStudent.phone || ''
                });
                setEditMode(false);
            };

            const handleExport = () => {
                const data = exportData();
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `student-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('داده‌های شما با موفقیت دانلود شد', 'success');
            };

            const currentClass = classes.find(c => c.id === currentStudent.classId);

            return (
                <div className="space-y-6 fade-in">
                    <div className="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h2 className="text-2xl font-bold text-gray-800 metallic-text">پروفایل دانش‌آموز</h2>
                            <p className="text-gray-600 mt-1">مدیریت اطلاعات شخصی و حساب کاربری</p>
                        </div>
                        <div className="flex space-x-3 space-x-reverse mt-4 md:mt-0">
                            <Button 
                                variant="outline"
                                icon="fa-download"
                                onClick={handleExport}
                                aria-label="دریافت پشتیبان از داده‌ها"
                            >
                                دریافت پشتیبان
                            </Button>
                            <Button 
                                variant={editMode ? "outline" : "primary"}
                                icon={editMode ? "fa-times" : "fa-edit"}
                                onClick={editMode ? handleCancel : () => setEditMode(true)}
                                aria-label={editMode ? "انصراف از ویرایش" : "ویرایش پروفایل"}
                            >
                                {editMode ? 'انصراف' : 'ویرایش پروفایل'}
                            </Button>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <Card className="lg:col-span-2">
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">اطلاعات شخصی</h3>
                            
                            {editMode ? (
                                <form onSubmit={handleSave}>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <FormInput
                                            label="نام کامل"
                                            value={formData.name}
                                            onChange={(e) => setFormData({...formData, name: e.target.value})}
                                            required
                                        />
                                        
                                        <FormInput
                                            label="ایمیل"
                                            type="email"
                                            value={formData.email}
                                            onChange={(e) => setFormData({...formData, email: e.target.value})}
                                        />

                                        <div className="md:col-span-2">
                                            <FormInput
                                                label="تلفن"
                                                type="tel"
                                                value={formData.phone}
                                                onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="flex space-x-3 space-x-reverse justify-end mt-6">
                                        <Button 
                                            type="button"
                                            variant="outline"
                                            onClick={handleCancel}
                                            aria-label="انصراف از ویرایش"
                                        >
                                            انصراف
                                        </Button>
                                        <Button 
                                            type="submit"
                                            variant="primary"
                                            icon="fa-save"
                                            aria-label="ذخیره تغییرات"
                                        >
                                            ذخیره تغییرات
                                        </Button>
                                    </div>
                                </form>
                            ) : (
                                <div className="space-y-4">
                                    <div className="flex items-center p-4 bg-gray-50 rounded-lg">
                                        <div className="flex-shrink-0 w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center ml-4">
                                            <i className="fas fa-user text-blue-600 text-xl"></i>
                                        </div>
                                        <div>
                                            <h4 className="font-medium text-gray-800 metallic-text">{currentStudent.name || 'نام تعریف نشده'}</h4>
                                            <p className="text-gray-600">شماره دانش‌آموزی: {currentStudent.studentId || 'تعریف نشده'}</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">ایمیل</label>
                                            <p className="text-gray-800">{currentStudent.email || 'تعریف نشده'}</p>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1 metallic-text">تلفن</label>
                                            <p className="text-gray-800">{currentStudent.phone || 'تعریف نشده'}</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </Card>

                        <Card>
                            <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">اطلاعات کلاس</h3>
                            <div className="space-y-4">
                                {currentClass ? (
                                    <>
                                        <div className="flex items-center p-3 bg-blue-50 rounded-lg">
                                            <i className="fas fa-chalkboard-teacher text-blue-600 ml-2"></i>
                                            <div>
                                                <p className="font-medium text-gray-800 metallic-text">{currentClass.name}</p>
                                                <p className="text-sm text-gray-600">مدرس: {currentClass.teacher}</p>
                                            </div>
                                        </div>
                                        
                                        <div className="space-y-2">
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">مقطع:</span>
                                                <span className="font-medium">{currentClass.grade}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">درس:</span>
                                                <span className="font-medium">{currentClass.subject}</span>
                                            </div>
                                        </div>
                                    </>
                                ) : (
                                    <div className="text-center py-4 text-gray-500">
                                        <i className="fas fa-chalkboard-teacher text-3xl mb-2"></i>
                                        <p>هیچ کلاسی برای شما تعریف نشده است</p>
                                    </div>
                                )}
                            </div>
                        </Card>
                    </div>

                    <Card>
                        <h3 className="text-lg font-semibold text-gray-800 mb-4 metallic-text">راهنما و پشتیبانی</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div className="p-4 bg-gray-50 rounded-lg text-center">
                                <i className="fas fa-book text-blue-600 text-2xl mb-2"></i>
                                <h4 className="font-medium text-gray-800">راهنمای استفاده</h4>
                                <p className="text-sm text-gray-600 mt-1">آموزش کار با پنل دانش‌آموز</p>
                            </div>
                            <div className="p-4 bg-gray-50 rounded-lg text-center">
                                <i className="fas fa-question-circle text-green-600 text-2xl mb-2"></i>
                                <h4 className="font-medium text-gray-800">سوالات متداول</h4>
                                <p className="text-sm text-gray-600 mt-1">پاسخ به سوالات رایج</p>
                            </div>
                            <div className="p-4 bg-gray-50 rounded-lg text-center">
                                <i className="fas fa-headset text-orange-600 text-2xl mb-2"></i>
                                <h4 className="font-medium text-gray-800">پشتیبانی فنی</h4>
                                <p className="text-sm text-gray-600 mt-1">تماس با واحد فنی</p>
                            </div>
                            <div className="p-4 bg-gray-50 rounded-lg text-center">
                                <i className="fas fa-comments text-purple-600 text-2xl mb-2"></i>
                                <h4 className="font-medium text-gray-800">نظرات و پیشنهادات</h4>
                                <p className="text-sm text-gray-600 mt-1">ارسال بازخورد</p>
                            </div>
                        </div>
                    </Card>
                </div>
            );
        };

        // =============================================
        // DEVELOPER: کامپوننت اصلی برنامه
        // =============================================
        const AppContent = () => {
            const { activeTab } = useStudentStore();

            const renderActiveContent = () => {
                switch (activeTab) {
                    case 'dashboard':
                        return <Dashboard />;
                    case 'schedule':
                        return <ClassSchedule />;
                    case 'calendar':
                        return <CalendarView />;
                    case 'educational-content':
                        return <EducationalContent />;
                    case 'assignments':
                        return <AssignmentsManagement />;
                    case 'content':
                        return <ContentManagement />;
                    case 'sessions':
                        return <SessionsManagement />;
                    case 'grades':
                        return <GradesManagement />;
                    case 'notifications':
                        return <NotificationsManagement />;
                    case 'profile':
                        return <ProfileManagement />;
                    default:
                        return <Dashboard />;
                }
            };

            return (
                <div className="flex h-screen rtl">
                    <Sidebar />
                    
                    <div className="flex-1 flex flex-col overflow-hidden main-content">
                        <Header />
                        
                        <main className="flex-1 overflow-auto p-4 md:p-6">
                            {renderActiveContent()}
                        </main>
                    </div>

                    <Notification />
                </div>
            );
        };

        // =============================================
        // DEVELOPER: تست‌ر خودکار برای اطمینان از عملکرد
        // =============================================
        const TestRunner = () => {
            const [testResults, setTestResults] = React.useState([]);
            const [showTests, setShowTests] = React.useState(true);

            const runTests = async () => {
                const results = [];
                
                // تست 1: عملیات CRUD روی تکالیف
                try {
                    const testAssignment = {
                        id: 'test-assignment',
                        title: 'تکلیف تست',
                        description: 'این یک تکلیف تست است',
                        classId: 'class-1',
                        dueDate: '1403/03/01',
                        maxScore: 20,
                        targets: {
                            type: 'individual',
                            students: ['student-1']
                        },
                        createdAt: new Date().toISOString()
                    };
                    
                    const assignments = studentStore.getState().assignments;
                    const assignmentExists = assignments.some(a => a.id === testAssignment.id);
                    
                    const shouldShow = testAssignment.targets.type === 'all' || 
                                     testAssignment.targets.students.includes('student-1');
                    
                    results.push({
                        name: 'عملیات CRUD روی تکالیف',
                        passed: assignmentExists && shouldShow,
                        message: assignmentExists && shouldShow 
                            ? 'تکالیف به درستی مدیریت می‌شوند' 
                            : 'خطا در مدیریت تکالیف'
                    });
                } catch (error) {
                    results.push({
                        name: 'عملیات CRUD روی تکالیف',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 2: ارسال پاسخ
                try {
                    const testSubmission = {
                        id: 'test-submission',
                        assignmentId: 'assignment-1',
                        studentId: 'student-1',
                        content: 'پاسخ تست',
                        submittedAt: new Date().toISOString()
                    };
                    
                    const submissions = studentStore.getState().submissions;
                    const submissionExists = submissions.some(s => s.id === testSubmission.id);
                    
                    results.push({
                        name: 'ارسال پاسخ (submission)',
                        passed: submissionExists,
                        message: submissionExists 
                            ? 'ارسال پاسخ با موفقیت انجام شد' 
                            : 'خطا در ارسال پاسخ'
                    });
                } catch (error) {
                    results.push({
                        name: 'ارسال پاسخ (submission)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 3: Persistence
                try {
                    const testData = { test: 'data', timestamp: Date.now() };
                    localStorage.setItem('test-persistence', JSON.stringify(testData));
                    const retrieved = JSON.parse(localStorage.getItem('test-persistence'));
                    
                    results.push({
                        name: 'Persistence (ذخیره‌سازی داده‌ها)',
                        passed: retrieved && retrieved.test === 'data',
                        message: retrieved && retrieved.test === 'data'
                            ? 'داده‌ها به درستی ذخیره و بازیابی می‌شوند'
                            : 'خطا در ذخیره‌سازی داده‌ها'
                    });
                } catch (error) {
                    results.push({
                        name: 'Persistence (ذخیره‌سازی داده‌ها)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 4: UI Rendering
                try {
                    const assignments = studentStore.getState().assignments;
                    const hasMultipleAssignments = assignments.length >= 2;
                    
                    const testBlob = new Blob(['test content'], { type: 'text/plain' });
                    const testUrl = URL.createObjectURL(testBlob);
                    const downloadLinkValid = testUrl.startsWith('blob:');
                    
                    results.push({
                        name: 'UI Rendering (نمایش رابط کاربری)',
                        passed: hasMultipleAssignments && downloadLinkValid,
                        message: hasMultipleAssignments && downloadLinkValid
                            ? 'رابط کاربری به درستی نمایش داده می‌شود'
                            : 'خطا در نمایش رابط کاربری'
                    });
                    
                    URL.revokeObjectURL(testUrl);
                } catch (error) {
                    results.push({
                        name: 'UI Rendering (نمایش رابط کاربری)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 5: Persian Date Input
                try {
                    const weekday = PersianDateUtils.getPersianWeekday('1403', '01', '01');
                    const isValidDate = PersianDateUtils.isValidPersianDate('1403', '01', '01');
                    
                    results.push({
                        name: 'Persian Date Input (ورودی تاریخ فارسی)',
                        passed: weekday === 'شنبه' && isValidDate,
                        message: weekday === 'شنبه' && isValidDate
                            ? 'ورودی تاریخ فارسی به درستی کار می‌کند'
                            : 'خطا در محاسبه تاریخ فارسی'
                    });
                } catch (error) {
                    results.push({
                        name: 'Persian Date Input (ورودی تاریخ فارسی)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 6: Accessibility
                try {
                    const buttons = document.querySelectorAll('button');
                    const buttonsWithAriaLabel = Array.from(buttons).filter(btn => 
                        btn.hasAttribute('aria-label') && btn.getAttribute('aria-label').trim() !== ''
                    );
                    
                    results.push({
                        name: 'Accessibility (دسترس‌پذیری)',
                        passed: buttonsWithAriaLabel.length > 0,
                        message: buttonsWithAriaLabel.length > 0
                            ? 'دکمه‌ها دارای برچسب دسترس‌پذیری هستند'
                            : 'برخی دکمه‌ها فاقد برچسب دسترس‌پذیری هستند'
                    });
                } catch (error) {
                    results.push({
                        name: 'Accessibility (دسترس‌پذیری)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 7: Network Fallback
                try {
                    const originalEnabled = BACKEND.enabled;
                    BACKEND.enabled = true;
                    
                    try {
                        await apiFetch('/test-endpoint');
                        results.push({
                            name: 'Network Fallback (fallback شبکه)',
                            passed: false,
                            message: 'انتظار خطای شبکه می‌رفت اما خطایی رخ نداد'
                        });
                    } catch (error) {
                        results.push({
                            name: 'Network Fallback (fallback شبکه)',
                            passed: true,
                            message: 'سیستم به درستی به localStorage fallback می‌کند'
                        });
                    } finally {
                        BACKEND.enabled = originalEnabled;
                    }
                } catch (error) {
                    results.push({
                        name: 'Network Fallback (fallback شبکه)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 8: برنامه کلاسی
                try {
                    const schedule = studentStore.getState().classSchedule;
                    const hasSchedule = Array.isArray(schedule);
                    
                    results.push({
                        name: 'Class Schedule (برنامه کلاسی)',
                        passed: hasSchedule,
                        message: hasSchedule
                            ? 'برنامه کلاسی به درستی کار می‌کند'
                            : 'خطا در سیستم برنامه کلاسی'
                    });
                } catch (error) {
                    results.push({
                        name: 'Class Schedule (برنامه کلاسی)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 9: تقویم جلالی
                try {
                    const today = new Date();
                    const jalaaliDate = jalaali.toJalaali(today);
                    const isValidJalaali = jalaaliDate.jy > 1300 && jalaaliDate.jy < 1500;
                    
                    results.push({
                        name: 'Jalaali Calendar (تقویم جلالی)',
                        passed: isValidJalaali,
                        message: isValidJalaali
                            ? 'تقویم جلالی به درستی کار می‌کند'
                            : 'خطا در سیستم تقویم جلالی'
                    });
                } catch (error) {
                    results.push({
                        name: 'Jalaali Calendar (تقویم جلالی)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                // تست 10: سرفصل‌های آموزشی
                try {
                    const educationalContent = studentStore.getState().educationalContent;
                    const hasContent = Array.isArray(educationalContent);
                    
                    results.push({
                        name: 'Educational Content (سرفصل‌های آموزشی)',
                        passed: hasContent,
                        message: hasContent
                            ? 'سرفصل‌های آموزشی به درستی کار می‌کنند'
                            : 'خطا در سیستم سرفصل‌های آموزشی'
                    });
                } catch (error) {
                    results.push({
                        name: 'Educational Content (سرفصل‌های آموزشی)',
                        passed: false,
                        message: `خطا: ${error.message}`
                    });
                }

                setTestResults(results);
                return results;
            };

            React.useEffect(() => {
                runTests();
            }, []);

            const allPassed = testResults.length > 0 && testResults.every(test => test.passed);

            if (!showTests) return null;

            return (
                <div className="test-results">
                    <div className="test-results-content">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-xl font-bold text-gray-800 metallic-text">نتایج تست‌های خودکار</h2>
                            <button 
                                onClick={() => setShowTests(false)}
                                className="text-gray-500 hover:text-gray-700"
                                aria-label="بستن نتایج تست"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="space-y-3 mb-4">
                            {testResults.map((test, index) => (
                                <div key={index} className={`test-item ${test.passed ? 'pass' : 'fail'}`}>
                                    <i className={`fas ${test.passed ? 'fa-check test-pass' : 'fa-times test-fail'} ml-3`}></i>
                                    <div className="flex-1">
                                        <div className="font-medium">{test.name}</div>
                                        <div className="text-sm text-gray-600">{test.message}</div>
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div className={`p-4 rounded-lg ${
                            allPassed ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'
                        }`}>
                            <div className="flex items-center">
                                <i className={`fas ${allPassed ? 'fa-check-circle' : 'fa-exclamation-triangle'} ml-2`}></i>
                                <span className="font-medium">
                                    {allPassed 
                                        ? '✅ تمام تست‌ها با موفقیت پاس شدند!' 
                                        : '❌ برخی تست‌ها ناموفق بودند'
                                    }
                                </span>
                            </div>
                        </div>
                        
                        <div className="flex justify-end mt-4">
                            <Button 
                                variant="primary"
                                onClick={() => setShowTests(false)}
                                aria-label="ادامه کار با پنل"
                            >
                                ادامه کار با پنل
                            </Button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [testsCompleted, setTestsCompleted] = React.useState(false);

            React.useEffect(() => {
                const testsRun = localStorage.getItem('tests-run');
                if (testsRun) {
                    setTestsCompleted(true);
                } else {
                    localStorage.setItem('tests-run', 'true');
                }
            }, []);

            return (
                <>
                    <AppContent />
                    {!testsCompleted && <TestRunner />}
                </>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>